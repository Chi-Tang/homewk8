

<HTML>
<HEAD><TITLE>由農曆(>國曆查天干地支<)簡易八字盤</TITLE></HEAD>
<BODY BGCOLOR=#FFFFFF>
<H2 ALIGN=CENTER>由農曆(>國曆查天干地支<)簡易八字盤></H2>
<H3>請輸入您農曆的年月日基本資料</H3>
 
<Form Action=Ent8989.aspx runat="server"  Method=POST>
  <Table border="1" cellpadding="2" cellspacing="0">
    <tr>
      <td>姓名：</td>
      <td><asp:TextBox runat="server" size="20" id="Name" /></td>
    </tr>
     <tr>
      <td>性別：</td>
      <td><asp:ListBox runat="server" id="Sex" size="1" Rows=2>
        <asp:ListItem>男</asp:ListItem>
        <asp:ListItem>女</asp:ListItem>
        </asp:ListBox></td>
    </tr>
   
    <tr>
      <td valign="top">年份：</td>
      <td valign="top">
      <asp:ListBox runat="server" id="YNUM" size="6">
        <asp:ListItem>1920</asp:ListItem><asp:ListItem>1921</asp:ListItem><asp:ListItem>1922</asp:ListItem><asp:ListItem>1923</asp:ListItem><asp:ListItem>1924</asp:ListItem>
        <asp:ListItem>1925</asp:ListItem><asp:ListItem>1926</asp:ListItem><asp:ListItem>1927</asp:ListItem><asp:ListItem>1928</asp:ListItem><asp:ListItem>1929</asp:ListItem>
        <asp:ListItem>1930</asp:ListItem><asp:ListItem>1931</asp:ListItem><asp:ListItem>1932</asp:ListItem><asp:ListItem>1933</asp:ListItem><asp:ListItem>1934</asp:ListItem>
        <asp:ListItem>1935</asp:ListItem><asp:ListItem>1936</asp:ListItem><asp:ListItem>1937</asp:ListItem><asp:ListItem>1938</asp:ListItem><asp:ListItem>1939</asp:ListItem>
        <asp:ListItem>1940</asp:ListItem><asp:ListItem>1941</asp:ListItem><asp:ListItem>1942</asp:ListItem><asp:ListItem>1943</asp:ListItem><asp:ListItem>1944</asp:ListItem>
        <asp:ListItem>1945</asp:ListItem><asp:ListItem>1946</asp:ListItem><asp:ListItem>1947</asp:ListItem><asp:ListItem>1948</asp:ListItem><asp:ListItem>1949</asp:ListItem>
        <asp:ListItem>1950</asp:ListItem><asp:ListItem>1951</asp:ListItem><asp:ListItem>1952</asp:ListItem><asp:ListItem>1953</asp:ListItem><asp:ListItem>1954</asp:ListItem>
        <asp:ListItem>1955</asp:ListItem><asp:ListItem>1956</asp:ListItem><asp:ListItem>1957</asp:ListItem><asp:ListItem>1958</asp:ListItem><asp:ListItem>1959</asp:ListItem>
        <asp:ListItem>1960</asp:ListItem><asp:ListItem>1961</asp:ListItem><asp:ListItem>1962</asp:ListItem><asp:ListItem>1963</asp:ListItem><asp:ListItem>1964</asp:ListItem>
        <asp:ListItem>1965</asp:ListItem><asp:ListItem>1966</asp:ListItem><asp:ListItem>1967</asp:ListItem><asp:ListItem>1968</asp:ListItem><asp:ListItem>1969</asp:ListItem>
        <asp:ListItem>1970</asp:ListItem><asp:ListItem>1971</asp:ListItem><asp:ListItem>1972</asp:ListItem><asp:ListItem>1973</asp:ListItem><asp:ListItem>1974</asp:ListItem>
        <asp:ListItem>1975</asp:ListItem><asp:ListItem>1976</asp:ListItem><asp:ListItem>1977</asp:ListItem><asp:ListItem>1978</asp:ListItem><asp:ListItem>1979</asp:ListItem>
        <asp:ListItem>1980</asp:ListItem><asp:ListItem>1981</asp:ListItem><asp:ListItem>1982</asp:ListItem><asp:ListItem>1983</asp:ListItem><asp:ListItem>1984</asp:ListItem>
        <asp:ListItem>1985</asp:ListItem><asp:ListItem>1986</asp:ListItem><asp:ListItem>1987</asp:ListItem><asp:ListItem>1988</asp:ListItem><asp:ListItem>1989</asp:ListItem>
        <asp:ListItem>1990</asp:ListItem><asp:ListItem>1991</asp:ListItem><asp:ListItem>1992</asp:ListItem><asp:ListItem>1993</asp:ListItem><asp:ListItem>1994</asp:ListItem>
        <asp:ListItem>1995</asp:ListItem><asp:ListItem>1996</asp:ListItem><asp:ListItem>1997</asp:ListItem><asp:ListItem>1998</asp:ListItem><asp:ListItem>1999</asp:ListItem>
        <asp:ListItem>2000</asp:ListItem><asp:ListItem>2001</asp:ListItem><asp:ListItem>2002</asp:ListItem><asp:ListItem>2003</asp:ListItem><asp:ListItem>2004</asp:ListItem>
        <asp:ListItem>2005</asp:ListItem><asp:ListItem>2006</asp:ListItem><asp:ListItem>2007</asp:ListItem><asp:ListItem>2008</asp:ListItem><asp:ListItem>2009</asp:ListItem>
        <asp:ListItem>2010</asp:ListItem><asp:ListItem>2011</asp:ListItem><asp:ListItem>2012</asp:ListItem><asp:ListItem>2013</asp:ListItem><asp:ListItem>2014</asp:ListItem>
        <asp:ListItem>2015</asp:ListItem><asp:ListItem>2016</asp:ListItem><asp:ListItem>2017</asp:ListItem><asp:ListItem>2018</asp:ListItem><asp:ListItem>2019</asp:ListItem>
        <asp:ListItem>2020</asp:ListItem><asp:ListItem>2021</asp:ListItem><asp:ListItem>2022</asp:ListItem><asp:ListItem>2023</asp:ListItem><asp:ListItem>2024</asp:ListItem><asp:ListItem>2025</asp:ListItem>
      
     </asp:ListBox></td>
    </tr>
    <tr>
      <td valign="top">月份：</td>
      <td valign="top">
      <asp:ListBox runat="server" id="MNUM" size="6"> 
         
        <asp:ListItem>1</asp:ListItem><asp:ListItem>2</asp:ListItem><asp:ListItem>3</asp:ListItem>
        <asp:ListItem>4</asp:ListItem><asp:ListItem>5</asp:ListItem><asp:ListItem>6</asp:ListItem>
        <asp:ListItem>7</asp:ListItem><asp:ListItem>8</asp:ListItem><asp:ListItem>9</asp:ListItem>
        <asp:ListItem>10</asp:ListItem><asp:ListItem>11</asp:ListItem><asp:ListItem>12</asp:ListItem>
    
 </asp:ListBox></td>
    </tr>
  <tr>
      <td>閏月：：</td>
      <td><asp:ListBox runat="server" id="LLeap" size="1" Rows=2>
        <asp:ListItem>true</asp:ListItem>
        <asp:ListItem>false</asp:ListItem>
        </asp:ListBox></td>
    </tr>
   <tr>
      <td valign="top">日份：</td>
      <td valign="top">
      <asp:ListBox runat="server" id="DNUM" size="6"> 
        <asp:ListItem>1</asp:ListItem><asp:ListItem>2</asp:ListItem><asp:ListItem>3</asp:ListItem><asp:ListItem>4</asp:ListItem><asp:ListItem>5</asp:ListItem>
        <asp:ListItem>6</asp:ListItem><asp:ListItem>7</asp:ListItem><asp:ListItem>8</asp:ListItem><asp:ListItem>9</asp:ListItem><asp:ListItem>10</asp:ListItem>
        <asp:ListItem>11</asp:ListItem><asp:ListItem>12</asp:ListItem><asp:ListItem>13</asp:ListItem><asp:ListItem>14</asp:ListItem><asp:ListItem>15</asp:ListItem>
        <asp:ListItem>16</asp:ListItem><asp:ListItem>17</asp:ListItem><asp:ListItem>18</asp:ListItem><asp:ListItem>19</asp:ListItem><asp:ListItem>20</asp:ListItem>
        <asp:ListItem>21</asp:ListItem><asp:ListItem>22</asp:ListItem><asp:ListItem>23</asp:ListItem><asp:ListItem>24</asp:ListItem><asp:ListItem>25</asp:ListItem>
        <asp:ListItem>26</asp:ListItem><asp:ListItem>27</asp:ListItem><asp:ListItem>28</asp:ListItem><asp:ListItem>29</asp:ListItem><asp:ListItem>30</asp:ListItem>
        <asp:ListItem>31</asp:ListItem>

      </asp:ListBox></td>
    </tr>
<tr>
      <td valign="top">時辰：</td>
      <td valign="top">
      <asp:ListBox runat="server" id="HNUM" size="6"> 
                           
        <asp:ListItem>子</asp:ListItem>
        <asp:ListItem>丑</asp:ListItem>
        <asp:ListItem>寅</asp:ListItem>
        <asp:ListItem>卯</asp:ListItem>
        <asp:ListItem>辰</asp:ListItem>
        <asp:ListItem>巳</asp:ListItem>
        <asp:ListItem>午</asp:ListItem>
        <asp:ListItem>未</asp:ListItem>
        <asp:ListItem>申</asp:ListItem>
        <asp:ListItem>酉</asp:ListItem>
        <asp:ListItem>戌</asp:ListItem>
        <asp:ListItem>亥</asp:ListItem>
  
      </asp:ListBox></td>
     </tr>
   </Table>
       <!--   外卦數碼：<asp:textbox id="txt1" runat="server" />-->
     <input id="inpHide" type="hidden" runat="server" />
      <asp:linkbutton id="LinkButton2"
       text="Open Web 傳送"
       OnClientClick="ACTjieqi()"
        onclick="LinkButton1_Click" 
           runat="Server" />
       <!--  onclick="Button_Click" --> 
        <!--OnClientClick="validate()"-->
        <!--unat="Server" />>-->
       <!--onclick="LinkButton1_Click"'OnClientClick="jieqi(2013,6)"-->
    
    </FORM>
 
 </BODY>
     <!--<=inpHide.Value%>-->
</HTML>
<%   ON ERROR RESUME NEXT 
    ''Dim YNUMm ,MNUMm ,DNUMm ,LLeapm
    'Dim YNUMm=Request("YNUM.Text")
    Dim YNUMm = YNUM.SelectedItem.Text
       Dim MNUMm = MNUM.SelectedItem.Text
       Dim DNUMm = DNUM.SelectedItem.Text
       Dim HNUMm = HNUM.SelectedItem.Text
       Dim Leapm = LLeap.SelectedItem.Text
       Dim SEXm = Sex.SelectedItem.Text

   ''Dim Syern,Smohn,Sdatn,Seaph
   Dim  Syern=Cint(YNUMm)
   Dim  Smohn=Cint(MNUMm)
   Dim  Sdatn=Cint(DNUMm)
       Dim Leaph = Leapm
       Dim Sexph = SEXm
   ''  Slunar=Lunar(Syern,Smohn,Sdatn)
  '' Slunar=Lunar(1915,3,6) '''''''''''須在于後呼叫'''''''''  
    Dim NToday = Now()
 Dim Ny = Year(NToday)
 Dim Nm = Month(NToday)
 Dim Nd = Day(NToday)
  'D11=  #1912/2/18#
  'D22=DateSerial(SECTM,TNUM,DNUM)
  'DYY=DateDiff("yyyy", D1, D2)
    'DDD=DateDiff("d", D1, D2) 
 %>   
 <script runat="server">

  Sub LinkButton1_Click(ByVal sender As Object, ByVal e As System.EventArgs)
        '' Dim LKGunar = Tcalendar(KGyern, KGmohn, KGdatn)
        Dim YNUMm = YNUM.SelectedItem.Text
        Dim MNUMm = MNUM.SelectedItem.Text
        Dim DNUMm = DNUM.SelectedItem.Text
        Dim HNUMm = HNUM.SelectedItem.Text
        Dim Leapm = LLeap.SelectedItem.Text
        Dim SEXm = Sex.SelectedItem.Text
        ''Dim Lyern,Lmohn,Ldatn,Leaph
        ''Dim KGLunar,KGPLunar ,KGyern,KGmohn,KGdatn,KGdlep 
        Dim Lyern = CInt(YNUMm)
        Dim Lmohn = CInt(MNUMm)
        Dim Ldatn = CInt(DNUMm)
         Dim Leaph = Leapm
        Dim Sexph = SEXm
        ''Dim Leaph="false"
         ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''' 
         ''Dim KGLunar,KGPLunar ,KGyern,KGmohn,KGdatn,KGdlep 
         Dim KGLunar = KLnar(Lyern, Lmohn, Ldatn, Leaph)
         '' KGLunar=KLnar(Syerng,Smohng,Sdatng,"false")
         '' KGLunar=KLnar(KSyern,KSmohn,KSdatn,KSdlep)
         Dim KGPLunar = Split(KGLunar, ";")
         Dim KGyern = CInt(KGPLunar(1))
         Dim KGmohn = CInt(KGPLunar(2))
         Dim KGdatn = CInt(KGPLunar(3))
         Dim KGdlep = KGPLunar(4)
         ''Dim LKGunar=Tcalendar(Syerng,Smohng,Sdatng )
         '' Dim LKGunar=Tcalendar(2012,2,14)
         Dim LKGunar = Tcalendar(KGyern, KGmohn, KGdatn)
         ''  Response.Write(KGLunar)
        '' Response.Write(LKGunar)
         ''Dim inityr        ''<=inpHide.Value% 取代之>   
         '' Dim injdays = jdays(False, 2012, 12, 31, 12)
         '' Response.Write(injdays)
         Dim initdy = initd()
         Response.Write("距前後節日" & initdy & "</br>")
         ''Dim initjg = jqtrmd(2013, 2)
         Dim initjg = jqTrm(YNUMm, 2)
         Response.Write("指定節日子"& initjg & "</br>")
         ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''         
       ''  Dim URL  Server.Transfer( URL )
            ''Dim YNUM, MNUM, DNUM, HNUM
        
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
   
        Dim SSEX, SSPNTRM, SSEXY
    Dim YYNUM, MMNUM, DDNUM, HHNUM
    Dim NYNUM, NMNUM, NDNUM, NHNUM
   Dim LLYR, LLDY, LLJG, HLLYR, HLeap, TS3, DG4 As String
    Dim i, k, J
    Dim TK(4), DG(4), TS(4), DS(4), TF(4), DF(4)
 
 '''''''''''''''''''''''''''''''''''''''''''
 SSex = Sexm
 YYNUM=YNUMm
 MMNUM=MNUMm
 DDNUM=DNUMm
 HHNUM=HNUMm
    HLLYR = inpHide.value
    HLeap = Leapm
    ''LLYR = Request("LYR")
    LLDY = initdy
    LLJG = initjg
   
 ''''''''''''''''''''''''''''''''''''''''''''''''''''''''     
    Dim HRTPZ =Right(Trim(HLLYR), 6)       ''Trim() 須去"r/n/"
    Response.Write("測inpide項" & HRTPZ & "</br>")
    Response.Write(HLLYR)
   
    ''On Error Resume Next
    '' Dim AVTK() = {"甲", "癸 ", "壬", "辛 ", "庚 ", "己 ", "戊 ", "丁 ", "丙 ", "乙 ", "甲"}
    '' Dim AVDG() = {"子", "亥 ", "戌 ", "酉 ", "申 ", "未 ", "午 ", "巳 ", "辰 ", "卯 ", "寅 ", "丑 ", "子"}
    '' Dim AVTK = StrReverse("子, 丑, 寅, 卯, 辰, 巳, 午, 未, 申, 酉, 戌, 亥,甲, 乙, 丙, 丁, 戊, 己, 庚, 辛,壬, 癸")
    '''    Response.Write(AVTK)
    For i = 1 To 3
       '' TK(i) = Mid(LLYR, 2 * i - 1, 1)
        TK(i) = Mid(HRTPZ, 2 * i - 1, 1)
        DG(i) = Mid(HRTPZ, 2 * i, 1)
    Next
   
    TS3 = "命主"
    DG4 = HHNUM
    TK(4) = TKFOR(TK(3), DG4)
    DG(4) = HHNUM
    '' Response.Write(TK(4))
    ''Response.Write((-21 mod 10))
    For k = 1 To 4
        TF(k) = TDFIV(TK(k))
        DF(k) = TDFIV(DG(k))
    Next
    For J = 1 To 4
        TS(J) = TDSTR(TF(3), TF(J))
        DS(J) = TDSTR(TF(3), DF(J))
    Next
     
    Dim Row0 = "<CENTER><TABLE Border=1 BGCOLOR=#FFFF00 >" & "<TR>" & "<TD width=30>年" & "</TD>" & "<TD width=30>月</TD>" & "<TD width =30>日</TD>" & "<TD width =30>時</TD>" & "<TD width =30>流年</TD>" & "<TD width =30>大運</TD>" & "</TR>"
    Dim Row1 = "<TR>" & "<TD width=30>" & TS(1) & "</TD>" & "<TD width=30>" & TS(2) & "</TD>" & "<TD width =30>" & TS3 & "<TD width =30>" & TS(4) & "</TD>" & "<TD width =30></TD>" & "<TD width =30></TD>" & "</TR>"
    Dim Row2 = "<TR>" & "<TD width=30>" & TF(1) & "</TD>" & "<TD width=30>" & TF(2) & "</TD>" & "<TD width =30>" & TF(3) & "<TD width =30>" & TF(4) & "</TD>" & "<TD width =30></TD>" & "<TD width =30></TD>" & "</TR>"
    Dim Row3 = "<TR>" & "<TD width=30>" & TK(1) & "</TD>" & "<TD width=30>" & TK(2) & "</TD>" & "<TD width =30>" & TK(3) & "<TD width =30>" & TK(4) & "</TD>" & "<TD width =30></TD>" & "<TD width =30></TD>" & "</TR>"
    Dim Row4 = "<TR>" & "<TD width=30>" & DG(1) & "</TD>" & "<TD width=30>" & DG(2) & "</TD>" & "<TD width =30>" & DG(3) & "<TD width =30>" & DG(4) & "</TD>" & "<TD width =30></TD>" & "<TD width =30></TD>" & "</TR>"
    Dim Row5 = "<TR>" & "<TD width=30>" & DF(1) & "</TD>" & "<TD width=30>" & DF(2) & "</TD>" & "<TD width =30>" & DF(3) & "<TD width =30>" & DF(4) & "</TD>" & "<TD width =30></TD>" & "<TD width =30></TD>" & "</TR>"
    Dim Row6 = "<TR>" & "<TD width=30>" & DS(1) & "</TD>" & "<TD width=30>" & DS(2) & "</TD>" & "<TD width =30>" & DS(3) & "<TD width =30>" & DS(4) & "</TD>" & "<TD width =30></TD>" & "<TD width =30></TD>" & "</TR>"
    Dim Row8 = "<TR style='writing-mode:bt-rl' width =150>" & "尊重著作權:<u>免費分享</u>" & "</TR>" & "</TABLE>" & "</CENTER>"
    '' Dim Row9 = "<CENTER><H5><FONT color=#FF0000>" & "若需要<u>卦 盤 評 論 表</u>" & "</FONT><HR></H5>"
    Dim Row10 = "<CENTER><H5><FONT color=#FF0000>" & "若需要<u>卦 盤 評 論 表</u> 請 Email:  tech.t1206@gmail.com 即可聯絡,  謝謝" & "</FONT><HR></H5>"
    Dim RowT = Row0 + Row1 + Row2 + Row3 + Row4 + Row5 + Row6 + Row8 + Row10
    Response.Write(RowT)
    '' Response.Write (Row8)
    SSEXY = Trim(((YYNUM - 1911) Mod 2)) + SSEX
    ''Response.Write(SSEXY + LLDY)
    Dim LLKT = SRCHLGNO(TK(2), DG(2), SSEXY, LLDY, TF(3))
    Dim LYRT = SRCHEGNO(TK(1), DG(1))
    ''.Response.Write(LLKT)


  End Sub
</script>
 <script Language="VB" runat="server">
       
         ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''         
     
    Function SRCHLGNO(TK2, DG2, SEXY, SDAY, TF3)
        Dim ASTK() = {"癸", "甲", "乙", "丙", "丁", "戊", "己", "庚", "辛", "壬", "癸"}
        Dim ASDG() = {"亥", "子", "丑", "寅", "卯", "辰", "巳", "午", "未", "申", "酉", "戌", "亥"}
        Dim AVTK() = {"甲", "癸", "壬", "辛", "庚", "己", "戊", "丁", "丙", "乙", "甲"}
        Dim AVDG() = {"子", "亥", "戌", "酉", "申", "未", "午", "巳", "辰", "卯", "寅", "丑", "子"}
   
        Dim i, j, k, m, n, xo, yo, ko, ko1, ko2 As Integer
        '' Dim LK(10), LLUK(10), LR(60), LYER(60)
        Dim LK(10), LLUK(10), AVTS(10), AVDS(10), AVTF(10), AVDF(10)
        Dim TSEXY = SEXY
        Dim ASVTK(), ASVDG()
        Dim TDAYS = Split(SDAY, ":")
        Dim TDAYS1 = CInt(TDAYS(0))
        Dim TDAYS2 = CInt(TDAYS(1))
        If TSEXY = "1男" Or TSEXY = "0女" Then
            '' ko = Fix(TDAYS2 / 3) + 1
            ko2 = (TDAYS2 / 3)
            If (ko2 - Fix(ko2)) <> 0 Then
                ko = Fix(ko2) + 1
            Else
                ko = Fix(ko2)
            End If
            ASVTK = ASTK
            ASVDG = ASDG
        Else
            '' ko = Fix(TDAYS1 / 3) + 1
            ko1 = (TDAYS1 / 3)
            If (ko1 - Fix(ko1)) <> 0 Then
                ko = Fix(ko1) + 1
            Else
                ko = Fix(ko1)
            End If
            ASVTK = AVTK
            ASVDG = AVDG
          
        End If
        ''  ko = 3
        For i = 1 To 10
            If ASVTK(i) = TK2 Then
                xo = i
                Exit For
            End If
        Next
        For j = 1 To 12
            If ASVDG(j) = DG2 Then
                yo = j
                Exit For
            End If
        Next
        For k = 1 To 10
            LK(k) = ko + (k - 1) * 10
            '' LLUK(k) = Trim(LK(k)) + ASVTK((xo + k) Mod 10) + ASVDG((yo + k) Mod 12)
            AVTF(k) = TDFIV(ASVTK((xo + k) Mod 10))
            AVDF(k) = TDFIV(ASVDG((yo + k) Mod 12))
        
            AVTS(k) = TDSTR(TF3, AVTF(k))
            AVDS(k) = TDSTR(TF3, AVDF(k))
            LLUK(k) = Trim(LK(k))+ AVTS(k) +"["+ ASVTK((xo + k) Mod 10) + ASVDG((yo + k) Mod 12)+"]" + AVDS(k)
        Next
        ' Dim Rw2
        '  For m = 1 To 2
        '' Dim Rw0 ="<CENTER><TABLE Border=1 BGCOLOR=#FFFF00 >"&"<TR>"&"<TD width=30>下(內)上(外)卦三爻數"&"</TD>"&"<TD width =30>變爻</TD>"&"<TD width =30>成卦名</TD>"&"<TD width =30>之卦名</TD>"&"</TR>"
        Dim Rw11 = "<CENTER><TABLE Border=1 >" & "<TR >" & "<TD>大運區:</TD>" & "<TD>" & LLUK(1) & "</TD>" & "<TD >" & LLUK(2) & "</TD>" & "<TD >" & LLUK(3) & "</TD>" & "<TD>" & LLUK(4) & "</TD>" & "<TD >" & LLUK(5) & "</TD>"
        '' Dim Rw2 = "<TR >" & "<TD>" & LLUK(6) & "</TD>" & "<TD >" & LLUK(7) & "</TD>" & "<TD >" & LLUK(8) & "</TD>" & "<TD>" & LLUK(9) & "</TD>" & "<TD >" & LLUK(10) & "</TD>" & "</TR>"
        Dim Rw12 = "<TD>" & LLUK(6) & "</TD>" & "<TD >" & LLUK(7) & "</TD>" & "<TD >" & LLUK(8) & "</TD>" & "<TD>" & LLUK(9) & "</TD>" & "<TD >" & LLUK(10) & "</TD>" & "</TR>"
          
        Dim Rw13 = Rw11 + Rw12 + "</TABLE>" + "</CENTER>"
        Response.Write(Rw13)
        
    End Function
    Function SRCHEGNO(TK1, DG1)
        Dim ATK() = {"癸", "甲", "乙", "丙", "丁", "戊", "己", "庚", "辛", "壬", "癸"}
        Dim ADG() = {"亥", "子", "丑", "寅", "卯", "辰", "巳", "午", "未", "申", "酉", "戌", "亥"}
        Dim i, j, k, m, n, xo, yo, ko As Integer
        Dim LR(60), LYER(60)
        ko = 3
        For i = 1 To 10
            If ATK(i) = TK1 Then
                xo = i
                Exit For
            End If
        Next
        For j = 1 To 12
            If ADG(j) = DG1 Then
                yo = j
                Exit For
            End If
        Next
        
        '' Dim Rw2
        For k = 1 To 60
            '' LR(k) = ko + (k - 1) * 10
            LYER(k) = Trim(k) + ATK((xo - 1 + k) Mod 10) + ADG((yo - 1 + k) Mod 12)
            '' Dim Rw1 = "<TD>" & LYER(k) & "</TD>"
            ''  Rw2 = Rw2 + Rw1
        Next
        Dim Rww1, Rww2, Rww3, Rww4, Rww5, Rww6, Rww7
        For m = 1 To 10
            ''LYER(m) = Trim(m) + ATK((xo + m) Mod 10) + ADG((yo + m) Mod 12)
            Rww1 = Rww1 + "<TD>" & LYER(m) & "</TD>"
            Rww2 = Rww2 + "<TD>" & LYER(10 + m) & "</TD>"
            Rww3 = Rww3 + "<TD>" & LYER(20 + m) & "</TD>"
            Rww4 = Rww4 + "<TD>" & LYER(30 + m) & "</TD>"
            Rww5 = Rww5 + "<TD>" & LYER(40 + m) & "</TD>"
            Rww6 = Rww6 + "<TD>" & LYER(50 + m) & "</TD>"
        Next
        '' Dim Rw0 ="<CENTER><TABLE Border=1 BGCOLOR=#FFFF00 >"&"<TR>"&"<TD width=30>下(內)上(外)卦三爻數"&"</TD>"&"<TD width =30>變爻</TD>"&"<TD width =30>成卦名</TD>"&"<TD width =30>之卦名</TD>"&"</TR>"
        ''  Dim Rw11 = "<CENTER><TABLE Border=1 >" & "<TR >" & "<TD>流年區:</TD>" & "<TD>" & LYER(1) & "</TD>" & "<TD >" & LYER(2) & "</TD>" & "<TD >" & LYER(3) & "</TD>" & "<TD>" & LYER(4) & "</TD>" & "<TD >" & LYER(5) & "</TD>"
        '' Dim Rw2 = "<TR >" & "<TD>" & LYER(6) & "</TD>" & "<TD >" & LYER(7) & "</TD>" & "<TD >" & LYER(8) & "</TD>" & "<TD>" & LYER(9) & "</TD>" & "<TD >" & LYER(10) & "</TD>" & "</TR>"
        ''    Dim Rw12 = "<TD>" & LYER(6) & "</TD>" & "<TD >" & LYER(7) & "</TD>" & "<TD >" & LYER(8) & "</TD>" & "<TD>" & LYER(9) & "</TD>" & "<TD >" & LYER(10) & "</TD>" & "</TR>"
        ''   Dim Rw13 = Rw11 + Rw12 + "</TABLE>" + "</CENTER>"
        ''  Response.Write(Rw13)
        '' Dim Rw13 = Rw11 + Rw12 + "</TABLE>" + "</CENTER>"
        ''  Response.Write(Rw13)
        Dim Rw0 = "<CENTER><TABLE Border=1 >" & "<TR >六十年甲子流年運區" & "</TR>"
        ''Dim Rw1 = "<TR>" & "<TD width=30>" & ( Join(Selected)) & "</TD>"& "<TD width =30>" & Selectd6 & "</TD>"& "<TD width =30>" & FGACK & "</TD>"& "<TD width =30>" & FGCCK & "</TD>"& "</TR>"&"</TABLE>"
        ''Dim Rw2 = "<TR>"&"<TD width=76 >" & FGACK & "</TD>"&"<TD>" & "</TD>" & "<TD width=30  >"& (MDN33+1) & "</TD>"&"<TD width=76>"& FGCCK &"</TD>"&"</TR>"&"</TABLE>"
        Dim RwT = Rw0 + "<TR >" + Rww1 + "/<TR >" + "<TR >" + Rww2 + "</TR >" + "<TR >" + Rww3 + "</TR >" + "<TR >" + Rww4 + "</TR >"+  "<TR >" + Rww5 + "</TR >" +"<TR >" + Rww6 + "</TR >" + "</TABLE>"
        Response.Write(RwT)
        ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
       
    End Function
     Function TKFOR(DTK3, HDG4)
        Dim ASTK() = {"癸","甲","乙","丙","丁","戊","己","庚","辛","壬","癸"}
        Dim ASDG() = {"亥","子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"}
     ' '  Dim AVTK() = {"0","癸","壬","辛","庚","己","戊","丁","丙","乙","甲"}
     ' '   Dim AVDG() = {"0","亥","戌","酉","申","未","午","巳","辰","卯","寅","丑","子"}
     ' ' Dim i, j, k, m, n, xo, yo, ko, ko1, ko2 As Integer
       ' ' Dim LK(12), LLUK(12), LR(60), LYER(60)
     ' ' Dim NAMT0(12),ZNAMT1(12),ZNAMT2(12),ZNAMT3(12),ZNAMT4(12) NAMT5(12),ZNAMT6(12),ZNAMT7(12),ZNAMT8(12),ZNAMT9(12),ZNAMT10(10)

Dim ZNAMTT(10,12)
Dim SKCOL()= {"癸","甲","乙","丙","丁","戊","己","庚","辛","壬","癸"}
Dim SKROW()= {"亥","子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"}
  ' 'Dim  ZNAMT0()= {"癸","壬","癸","甲","乙","丙","丁","戊","己","庚","辛","壬","癸"}
Dim  ZNAMT1()= {"乙","甲","乙","丙","丁","戊","己","庚","辛","壬","癸","甲","乙"}
Dim  ZNAMT2()= {"丁","丙","丁","戊","己","庚","辛","壬","癸","甲","乙","丙","丁"}
Dim  ZNAMT3()= {"己","戊","己","庚","辛","壬","癸","甲","乙","丙","丁","戊","己"}
Dim  ZNAMT4()= {"辛","庚","辛","壬","癸","甲","乙","丙","丁","戊","己","庚","辛"}
Dim  ZNAMT5()= {"癸","壬","癸","甲","乙","丙","丁","戊","己","庚","辛","壬","癸"}
Dim  ZNAMT6()= {"乙","甲","乙","丙","丁","戊","己","庚","辛","壬","癸","甲","乙"}
Dim  ZNAMT7()= {"丁","丙","丁","戊","己","庚","辛","壬","癸","甲","乙","丙","丁"}
Dim  ZNAMT8()= {"己","戊","己","庚","辛","壬","癸","甲","乙","丙","丁","戊","己"}
Dim  ZNAMT9()= {"辛","庚","辛","壬","癸","甲","乙","丙","丁","戊","己","庚","辛"}
Dim  ZNAMT10()= {"癸","壬","癸","甲","乙","丙","丁","戊","己","庚","辛","壬","癸"}
 ' '//Dim ZNAMTT(10,12)   // x[5][12] = 3.0;
 ' '     var ZNAMTT = new Array(8);
  Dim i, j, k, m, n As Integer
  For i = 0 To 12
       ZNAMTT(1,i) = ZNAMT1(i) 
       ZNAMTT(2,i) = ZNAMT2(i) 
       ZNAMTT(3,i) = ZNAMT3(i) 
       ZNAMTT(4,i) = ZNAMT4(i) 
       ZNAMTT(5,i) = ZNAMT5(i) 
       ZNAMTT(6,i) = ZNAMT6(i)
       ZNAMTT(7,i) = ZNAMT7(i) 
       ZNAMTT(8,i) = ZNAMT8(i) 
       ZNAMTT(9,i) = ZNAMT9(i) 
       ZNAMTT(10,i) = ZNAMT10(i) 
          
       Next
        
        For j = 0 To 10
        If SKCOL(j) = DTK3 Then
        m = j
         Exit For
          End If
        Next

        For k= 0 To 12
        If SKROW(k) = HDG4 Then
        n = k
         Exit For
          End If
        Next
     ' '' ' // return (ZNAMTT[m][n]);
      ' '   // return (m+n);
     ' '// } // End Function 
       Return (ZNAMTT(m,n))
        
End Function

Function TDSTR(FTK3,FDG4)
        Dim ASTK() = {"癸","甲","乙","丙","丁","戊","己","庚","辛","壬","癸"}
        Dim ASDG() = {"亥","子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"}
     ' '  Dim AVTK() = {"甲","癸","壬","辛","庚","己","戊","丁","丙","乙","甲"}
     ' '   Dim AVDG() = {"子","亥","戌","酉","申","未","午","巳","辰","卯","寅","丑","子"}
     ' ' Dim i, j, k, m, n, xo, yo, ko, ko1, ko2 As Integer
       ' ' Dim LK(12), LLUK(12), LR(60), LYER(60)
     ' ' Dim NAMT0(12),ZNAMT1(12),ZNAMT2(12),ZNAMT3(12),ZNAMT4(12) NAMT5(12),ZNAMT6(12),ZNAMT7(12),ZNAMT8(12),ZNAMT9(12),ZNAMT10(10)

Dim ZNAMTT(10,12)
Dim SKCOL()= {"	-水","+木","-木","+火","-火","+土","-土","+金","-金","+水","	-水"}
Dim SKROW()= {"	-水","+木","-木","+火","-火","+土","-土","+金","-金","+水","	-水"}
  ' 'Dim  ZNAMT10()= {"比肩","傷官","食神","正財","偏財","正官","偏官","正印","偏印","劫財","比肩"}
Dim  ZNAMT1()= {"正印","比肩","劫財","食神","傷官","	偏財","正財","偏官","正官","偏印","正印"}
Dim  ZNAMT2()= {"偏印","劫財","比肩","傷官","食神","正財","偏財","正官","偏官","正印","偏印"}
Dim  ZNAMT3()= {"正官","偏印","正印","比肩","劫財","食神","傷官","偏財","正財","偏官","正官"}
Dim  ZNAMT4()= {"偏官","正印","偏印","劫財","比肩","傷官","食神","正財","偏財","正官","偏官"}
Dim  ZNAMT5()= {"正財","偏官","正官","偏印","正印","比肩","劫財","食神","傷官","偏財","正財"}
Dim  ZNAMT6()= {"偏財","正官","偏官","正印","偏印","劫財","比肩","傷官","食神","正財","偏財"}
Dim  ZNAMT7()= {"傷官","偏財","正財","偏官","正官","偏印","正印","比肩","劫財","食神","傷官"}
Dim  ZNAMT8()= {"食神","正財","偏財","正官","偏官","正印","偏印","劫財","比肩","傷官","食神"}
Dim  ZNAMT9()= {"劫財","食神","傷官","偏財","正財","偏官","正官","偏印","正印","比肩","劫財"}
Dim  ZNAMT10()= {"比肩","傷官","食神","正財","偏財","正官","偏官","正印","偏印","劫財","比肩"}


 ' '//Dim ZNAMTT(10,12)   // x[5][12] = 3.0;
 ' '     var ZNAMTT = new Array(8);
  Dim i, j, k, m, n As Integer
  For i = 0 To 10
       ZNAMTT(1,i) = ZNAMT1(i) 
       ZNAMTT(2,i) = ZNAMT2(i) 
       ZNAMTT(3,i) = ZNAMT3(i) 
       ZNAMTT(4,i) = ZNAMT4(i) 
       ZNAMTT(5,i) = ZNAMT5(i) 
       ZNAMTT(6,i) = ZNAMT6(i)
       ZNAMTT(7,i) = ZNAMT7(i) 
       ZNAMTT(8,i) = ZNAMT8(i) 
       ZNAMTT(9,i) = ZNAMT9(i) 
       ZNAMTT(10,i) = ZNAMT10(i) 
          
       Next
        
        For j = 0 To 10        

        If Trim(SKCOL(j)) = Trim(FTK3) Then
        m = j
         Exit For
          End If
        Next

        For k= 0 To 10
        If Trim(SKROW(k)) = Trim(FDG4) Then
        n = k
         Exit For
          End If
        Next
     ' '' ' // return (ZNAMTT[m][n]);
      ' '   // return (m+n);
     ' '// } // End Function 
       Return (ZNAMTT(m,n))
        
End Function
           
  Function TDFIV(DGTK)
        Dim ASTK() = {"癸","甲","乙","丙","丁","戊","己","庚","辛","壬","癸"}
        Dim ASDG() = {"亥","子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"}
        Dim mad11,mad22 As String
          
      ' '  Dim AVTK() = {"甲","癸","壬","辛","庚","己","戊","丁","丙","乙","甲"}
     ' '   Dim AVDG() = {"子","亥","戌","酉","申","未","午","巳","辰","卯","寅","丑","子"}
     ' ' Dim i, j, k, m, n, xo, yo, ko, ko1, ko2 As Integer
     ' ' Dim LK(12), LLUK(12), LR(60), LYER(60)
     ' ' Dim NAMT0(12),ZNAMT1(12),ZNAMT2(12),ZNAMT3(12),ZNAMT4(12) NAMT5(12),ZNAMT6(12),ZNAMT7(12),ZNAMT8(12),ZNAMT9(12),ZNAMT10(10)
    ' ' Dim ZNAMTT(10,12)
Dim TKDG()= {"亥","甲","乙","丙","丁","戊","己","庚","辛","壬","癸","子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"}
Dim SXFIV()= {"+水","+木","-木","+火","-火","+土","-土","+金","-金","+水","	-水","-水","-土","+木","-木","+土","+火","-火","-土","+金","-金","+土","+水"}
 ''Dim  ZNAMT0()= {"0","壬","癸","甲","乙","丙","丁","戊","己","庚",
''//Dim ZNAMTT(10,12)   // x[5][12] = 3.0;
 ' //    var ZNAMTT = new Array(8);
  Dim i, j, k, m, n As Integer
  For j = 0 To 22
        If Trim(TKDG(j)) = Trim(DGTK) Then
            mad22= SXFIV(j)
            Exit For
        End If
    Next

    Return mad22
   End Function
 
 
</script>
  
    <script Language="VB" runat="server">
      
      '''''''''''''''''''''''''''''''''''''
        Function initialize()
            Dim Today, Ny, Nm, Nd
            ''Today = Date()
            Today = Now
            Ny = Today.getFullYear()
            Nm = Today.getMonth()
            Nd = Today.getDate()
            ''// CLD.SY.selectedIndex=Ny-1912
            ''/// CLD.SM.selectedIndex=Nm
        End Function

        Dim NMonthDays() = {31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31}
        Function isLeapYear(y, m)
            If (m = 1) Then
                '''return(((y%4 == 0) && (y%100 != 0) || (y%400 == 0))? 29: 28)
                ''IF ((y/4 = 0) and (y/100 <> 0) or (y/400 = 0)) THEN
                If (((y Mod 4) = 0) And ((y Mod 100) <> 0)) Or ((y Mod 400) = 0) Then
                    isLeapYear = 29
                Else
                    isLeapYear = 28
                End If
    
            Else
                ''return(NMonthDays[m])
                isLeapYear = NMonthDays(m)
            End If
        End Function
 
        Dim MK() = {&H10000, &H8000, &H4000, &H2000, &H1000, &H800, &H400, &H200, &H100, &H80, &H40, &H20, &H10, &H8, &H4, &H2, &H1}
        Function lYearDays(y)
            Dim i, k, sum
            sum = 0
            ''hxy =("&h"&Mid(y,1,5))
            '' hxy =StrToInt(y,5)
            ''k=StrToInt(y,5)
            k = StrToInt2(y, 4)
            ''for(i=1;i<13;i++) sum += (k & (0x10000>>i))? 30 : 29;
            ''return(sum+leapDays(y));
            For i = 1 To 12
                If (k And MK(i)) <> 0 Then
                    sum = sum + 30
                Else
                    sum = sum + 29
                End If
            Next
            lYearDays = sum + leapDays(y)
   
        End Function

        Function leapDays(y)
            ''if(leapMonth(y)) return( (StrToInt(y,1)&0xf)? 30: 29)
            ''else return(0)
            Dim hxy, lpDays
            If leapMonth(y) <> 0 Then
                ''hxy =("&h"&Mid(y,1,1))
                hxy = StrToInt(y, 1)
                If (hxy And (&HF)) <> 0 Then
                    lpDays = 30
                Else
                    lpDays = 29
                End If
            Else
                lpDays = 0
            End If
            Return lpDays
        End Function

        Function leapMonth(y)
            ''return(StrToInt(y,5) & 0xf);
            ''hxy =("&h"&Mid(y,1,5))
            Dim hxy = StrToInt(y, 5)
            If (hxy And (&HF)) <> 0 Then
                leapMonth = (hxy And (&HF))
            Else
                leapMonth = 0
            End If

        End Function

        Dim hxym, hxymk, LmhDays
        Function LmonthDays(y, m)
            ''return( (StrToInt(y,5) & (0x10000>>m))? 30: 29 );
            '''hxy =("&h"&Mid(y,1,5))  ''(k and MK(i))<>0
            ''hxy =StrToInt(y,5)
            hxym = StrToInt2(y, 4)
            ''hxymk =Hex(hxym and MK(m))
            If (hxym And MK(m)) > m Then
                ''LDy=Hex(hxy and (&h10000))&"hellow; ok"
                ''tst=Hex((&had) and (&h88))
                LmhDays = 30
            Else
                ''LDy=Hex(hxy and (&h10000))&"hellow; no"
                LmhDays = 29
            End If
            '' LDy=hxy
            LmonthDays = LmhDays
        End Function
 
        '' Response.write    LmonthDays(1919,1)&"日"&hxym&"<BR>"
        ''Response.write    (Hex((&h4977)and (&h08000)))&"<BR>"
 
        Dim LunData() = {"0A4D0", "0D250", "1D295", "0B550", "056A0", "0ADA2", "095B0", "14977", "049B0", "0A4B0", _
                         "0B4B5", "06A50", "06D40", "1AB54", "02B60", "09570", "052F2", "04970", "06566", "0D4A0", _
                         "0EA50", "16A95", "05AD0", "02B60", "186E3", "092E0", "1C8D7", "0C950", "0D4A0", "1D8A6", _
                         "0B550", "056A0", "1A5B4", "025D0", "092D0", "0D2B2", "0A950", "0B557", "06CA0", "0B550", _
        "15355", "04DA0", "0A5B0", "14573", "052B0", "0A9A8", "0E950", "06AA0", "0AEA6", "0AB50", _
        "04B60", "0AAE4", "0A570", "05260", "0F263", "0D950", "05B57", "056A0", "096D0", "04DD5", _
        "04AD0", "0A4D0", "0D4D4", "0D250", "0D558", "0B540", "0B6A0", "195A6", "095B0", "049B0", _
        "0A974", "0A4B0", "0B27A", "06A50", "06D40", "0AF46", "0AB60", "09570", "04AF5", "04970", _
        "064B0", "074A3", "0EA50", "06B58", "05AC0", "0AB60", "096D5", "092E0", "0C960", "0D954", _
        "0D4A0", "0DA50", "07552", "056A0", "0ABB7", "025D0", "092D0", "0CAB5", "0A950", "0B4A0", _
        "0BAA4", "0AD50", "055D9", "04BA0", "0A5B0", "15176", "052B0", "06930", "07954", "06AA0", _
        "0AD50", "05B52", "04B60", "0A6E6", "0A4E0", "0D260", "0EA65", "0D520", "0DAA0", "076A3", _
        "096D0", "04AFB", "04AD0", "0A4D0", "1D0B6", "0D250", "0D520", "0DD45", "0B5A0", "056D0", _
        "055B2", "049B0", "0A577", "0A4B0", "0AA50", "1B255", "06D20", "0ADA0", "14B63", "09370", _
        "049F8", "04970", "064B0", "168A6", "0EA50", "06B20", "1A6C4", "0AAE0", "092E0", "0D2E3", _
        "0C960", "0D557", "0D4A0", "0DA50", "05D55", "056A0", "0A6D0", "055D4", "052D0", "0A9B8"}

        Function StrToInt(yx, vx)

            Dim sr, hsr
            sr = LunData(yx - 1912)
            ''sr= LunData[yx-1912]
            '' sr=sr.substring(0, vx);
            '' return (parseInt('0x'+sr));
            ''sr=MID(1,VX)
            hsr = ("&h" & Mid(sr, 1, vx))
            StrToInt = hsr
        End Function
        Function StrToInt2(yx, vx)
            Dim sr2, hsr2
            sr2 = LunData(yx - 1912)
            hsr2 = ("&h" & Mid(sr2, 2, vx))
            StrToInt2 = hsr2
        End Function
        ' Response.write  NToday&Ny&Nm&Nd 
        ''Response.write lYearDays(1925)&leapMonth(1925)
        '' Response.write  Lunar(1926,1,10)
        ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
        Function Lunar(SECTM, TNUM, DNUM)
            Dim i, j, k, offsett, offsety, offsetm, offsetd, temp, tempm, tempd, offsettm
            Dim D1, D2, DY, DD
            Dim thisyr, thisleap, thismth, thisday
            Dim leap = 0
            temp = 0
            D1 = #2/18/1912#
            D2 = DateSerial(SECTM, TNUM, DNUM)
            DY = DateDiff("yyyy", D1, D2)
            DD = DateDiff("d", D1, D2)
            ' YK8 = DY+8
            ' YK = YK8 MOD 10
            ' YG = DY MOD 12
            ' MG1= TNUM+1
            ' MG = MG1 MOD 12
            ' DK = DD MOD 10
            ' DG = DD MOD 12

            ''offset = (Date.UTC(objDate.getFullYear(),objDate.getMonth(),objDate.getDate())-Date.UTC(1912,1,18))/86400000)
            offsett = DateDiff("d", D1, D2)
                      
            'for(i=1912; i<2072 && offset>0; i++) { temp=lYearDays(i); offset-=temp }
            ' if(offset<0) { offset+=temp; i--; }
            ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''' 
            i = 1912
            While offsett >= 0
                temp = lYearDays(i)
                offsett = offsett - temp
                i = i + 1
                '' WEND
            End While
   
            If offsett < 0 Then
                i = i - 1
                offsetm = offsett + temp
         
            End If
    
            thisyr = i
            leap = leapMonth(i)
            thisleap = False
            '''''''''''''''''''''''''''''''''''''''''''''''''''''''
            ''j=0
            j = 1
            While (offsetm > 0 And j < 13)
                ''j=j+1
                If (leap > 0 And j = (leap + 1) And thisleap = False) Then
                    j = j - 1
                    thisleap = True
                    tempm = leapDays(thisyr)
                Else
                    tempm = LmonthDays(thisyr, j)
                End If
                If (thisleap = True And j = (leap + 1)) Then
                    thisleap = False
                End If
                offsetm = offsetm - tempm
                j = j + 1
                '' WEND 
            End While

            If (offsetm = 0 And leap > 0 And j = leap + 1) Then
                If (thisleap = True) Then
                    thisleap = False
                Else
                    thisleap = True
                    j = j - 1
                End If
            End If
            If (offsetm < 0) Then
                offsetd = offsetm + tempm
                j = j - 1
            End If
            thismth = j
            thisday = offsetd + 1
            '' Lunar=Lunars&thisyr&"年"& thismth&"月"&thisday&"整總日"&DD
            '' Lunar= thisyr&";"& thismth&";"&thisday&";"&thisLeap
            Lunar = CInt(thisyr) & ";" & CInt(thismth) & ";" & CInt(thisday) & ";" & thisleap
        End Function
        '''''''''''''''''''''''''''''''''''''''''''''''''''''''
        Dim TermDatav() = {0, 21324, 42505, 63868, 85407, 107110, 128977, 151002, 173218, 195611, 218134, 240768, 263418, 286062, 308631, 331096, 353423, 375568, 397546, 419292, 440895, 462344, 483626, 504891, 0, 21324}
        Function ssTerm(y, nn)
            Dim DDA, DDD, MnD
            Dim D1t = #1/7/1912#
            Dim Mn = (525948.77 * (y - 1912) + TermDatav(nn))
            DDA = DateAdd("n", Mn, D1t)
            DDD = Day(DDA)
            ''ssTerm=DDt
            ssTerm = DDD
        End Function
        ''Dim ssTermt
        '' ssTermt=ssTerm(2012,5)
        ''  Response.write ssTermt
    
        Dim Gan() = {"甲", "乙", "丙", "丁", "戊", "己", "庚", "辛", "壬", "癸"}
        Dim Zhi() = {"子", "丑", "寅", "卯", "辰", "巳", "午", "未", "申", "酉", "戌", "亥"}
        Function GanZhi(num)
            ' 'return(Gan[num%10]+Zhi[num%12])
            Dim Gant, Zhit
            Gant = Gan(num Mod 10)
            Zhit = Zhi(num Mod 12)
            GanZhi = Gant + Zhit
        End Function
 
        Function LYMDS(yp, mp, dp, mslp)
            Dim LLmhp, Lmp, accud
            accud = 0
            Lmp = CInt(mp)
            LLmhp = CInt(leapMonth(yp))
     
            If LLmhp <> 0 Then
                ''accud = AcuYdsm(yp-1)+AcuMd(yp,mp)+dp
                If (Lmp = LLmhp) Then
           
                    If (mslp = "true") Then
                        accud = AcuYdsm(yp - 1) + AcuMd(yp, mp) + dp
                    Else
                        accud = AcuYdsm(yp - 1) + AcuMd(yp, mp - 1) + dp
                    End If

                Else
                    If (Lmp < LLmhp) Then
                        accud = AcuYdsm(yp - 1) + AcuMd(yp, mp - 1) + dp
                    Else
                        accud = AcuYdsm(yp - 1) + AcuMd(yp, mp - 1) + leapDays(yp) + dp
                    End If
       
                End If
                ''accud = AcuYdsm(yp-1)+AcuMd(yp,mp-1)+dp
            Else
                accud = AcuYdsm(yp - 1) + AcuMd(yp, mp - 1) + dp

     
            End If
            '' LYMDS =AcuMd(yp,mp)
            LYMDS = accud
        End Function
  
        '' Dim MK()= {&h10000,&h08000,&h04000,&h02000,&h01000,&h00800,&h00400,&h00200,&h00100,&h00080,&h00040,&h00020,&h00010,&h00008,&h00004,&h00002,&h00001}
        Function AcuMd(ypx, mpx)
            Dim i, k, sumd, sum
            sum = 0
            ''hxy =("&h"&Mid(y,1,5))
            '' hxy =StrToInt(y,5)
            ''k=StrToInt(y,5)
  
            k = StrToInt2(ypx, 4)
            ''for(i=1;i<13;i++) sum += (k & (0x10000>>i))? 30 : 29;
            ''return(sum+leapDays(y));
            For i = 1 To mpx
                If (k And MK(i)) <> 0 Then
                    sumd = 30
                Else
                    sumd = 29
                End If
                sum = sum + sumd
            Next
            '' lYAcumd=sum+leapDays(ypx) 
            AcuMd = sum
     
        End Function

        Function Ydsm(yp)
            Dim i, k, sum, sumr
            sum = 0
            ''hxy =("&h"&Mid(y,1,5))
            '' hxy =StrToInt(y,5)
            ''k=StrToInt(y,5)
  
            k = StrToInt2(yp, 4)
            ''for(i=1;i<13;i++) sum += (k & (0x10000>>i))? 30 : 29;
            ''return(sum+leapDays(y));
            For i = 1 To 12
                If (k And MK(i)) <> 0 Then
                    sumr = 30
                Else
                    sumr = 29
                End If
                sum = sum + sumr
    
            Next
            Ydsm = sum + leapDays(yp)
        End Function

        Function AcuYdsm(ypp)
 
            Dim j, total, tempy
            total = 0
            For j = 1912 To ypp
                tempy = Ydsm(j)
                total = total + tempy
            Next
            AcuYdsm = total
        End Function
        '''''''''''''''''''''''''''''''''''''''''''''''''''''''
        '''function KLnar(objDate)
        Function KLnar(ky, km, kd, klp)
            Dim i, j, k, offsett, offsety, offsetm, offsetd, temp, tempm, tempd, offsettm
            Dim D1, D2, DY, DD
            Dim leap, klyrs, kisyr, kismth, kisday, kisLeap

            Dim thisleap
            leap = 0
            temp = 0
            D1 = #1/1/1912#
            D2 = DateSerial(ky, km, kd)
            DY = DateDiff("yyyy", D1, D2)
            DD = DateDiff("d", D1, D2)
            ''offset = (Date.UTC(objDate.getFullYear(),objDate.getMonth(),objDate.getDate())-Date.UTC(1912,1,18))/86400000)
            '' offsett = DateDiff("d", D1, D2) 
            offsett = LYMDS(ky, km, kd, klp) + 47
            i = 1912
            While offsett >= 0
                If (((i Mod 4) = 0) And ((i Mod 100) <> 0)) Or ((i Mod 400) = 0) Then
                    klyrs = 366
                Else
                    klyrs = 365
                End If
                temp = klyrs
                offsett = offsett - temp
                i = i + 1
  
            End While
   
            If offsett < 0 Then
                i = i - 1
                offsetm = offsett + temp
         
            End If
            kisyr = i
            ''leap = leapMonth(2)
            leap = 2
            thisleap = False
            '' '''''''''''''''''''''''''''''''''''''''''''''''''''''
            Dim KLMDays() = {0, 31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31}
            Dim KLMDayd() = {0, 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31}
            Dim kismh
            ''j=0
            j = 1
            While (offsetm > 0 And j < 13)
                ''j=j+1
                If (((kisyr Mod 4) = 0) And ((kisyr Mod 100) <> 0)) Or ((kisyr Mod 400) = 0) Then
                    thisleap = True
                    kismh = KLMDays(j)
                Else
                    thisleap = False
                    kismh = KLMDayd(j)
                End If
                tempm = kismh
                offsetm = offsetm - tempm
                j = j + 1
                ''WEND 
            End While

            If (offsetm = 0 And j = leap) Then
                If (thisleap = True) Then
                    thisleap = False
                Else
                    thisleap = True
        
                End If
                j = j - 1
            End If
            If (offsetm < 0) Then
                offsetd = offsetm + tempm
                j = j - 1
            End If
        
            kismth = j
            kisday = offsetd + 1
            If kismth > 12 Then
                kismth = kismth - 12
                kisyr = kisyr + 1
            Else
                kismth = kismth
            End If
            kisLeap = thisleap
  
            '' KLnar= "<BR>"&ky&km&kd&klp&"農化國年"&kisyr&";"& kismth&";"&kisday&";"&kisLeap
 
            KLnar = "農化國年" & ";" & CInt(kisyr) & ";" & CInt(kismth) & ";" & CInt(kisday) & ";" & kisLeap
  
        End Function
        ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
 
        Dim SolarTerm() = {"小寒", "大寒", "立春", "雨水", "驚蟄", "春分", "清明", "穀雨", "立夏", "小滿", "芒種", "夏至", "小暑", "大暑", "立秋", "處暑", "白露", "秋分", "寒露", "霜降", "立冬", "小雪", "大雪", "冬至"}
        Dim dStr1() = {"日", "一", "二", "三", "四", "五", "六", "七", "八", "九", "十"}
        Dim Tcalary(12, 33, 12)

        Function Tcalendar(y, m, dx)
            Dim sDO2, sDOj, lDOj, lDOjv, Ld, Lx, Ly, Lm, Lp, Lpp, thfsw, tmp1, tmp2, tmp3, firstNode
            Ld = 0
            Lx = 1
            Dim Cy, Cm, Jm, Cd
            Dim Ldpos(3)
            Dim n, nn, firstLM, i
            n = 0
            firstLM = 0
  
            Dim D1D, D2D, DCA, DCD, DCLD
            Dim thisfstW, thisln, term2
            Dim Syerp, Smohp, Sdatp
            D1D = #1/7/1912#  '''"節氣日"
            D2D = #1/1/1912#   '''"化國曆之起日"''D2L= #1912/2/18#'''化農曆之起日'' 
            sDO2 = DateSerial(y, m, 1)
            ''sDO2=sDObj = new Date(y,m,1,0,0,0,0) 
            ''DCY=DateDiff("yyyy", D1D, sDO2)
            ''DCN=DateDiff("n", D1D, sDO2)
            Cm = (525948.77 * (y - 1912) + TermDatav(nn))
            DCA = DateAdd("n", Cm, D1D)
            DCD = Day(DCA)
            thisfstW = DatePart("w", sDO2) - 1
            thisln = isLeapYear(y, m - 1)
  
            If ((m - 1) < 2) Then
                Cy = GanZhi(y - 1912 + 47)
            Else
                Cy = GanZhi(y - 1912 + 48)
            End If
            ''term2=ssTerm(y,2)  ''''立春''''
            ''firstNode = ssTerm(y,(m-1)*2)   ''''當月的首節氣為幾日''''
            term2 = jqTrm(y, 2 + 1)  ''''立春''''
            firstNode = jqTrm(y, (m - 1) * 2 + 1)   ''''當月的首節氣為幾日''''
  
            Cm = GanZhi((y - 1912) * 12 + (m - 1) + 36)

            ''Jm = GanZhi((y-1912)*12+m+36)
            ''var dayCyclical = Date.UTC(y,m,1,0,0,0,0)/86400000+21185+12
            DCLD = DateDiff("d", D2D, sDO2) + 12
            '' for(var i=0;i<this.length;i++) {
            For i = 1 To thisln
                '' if(Ld<Lx) then
                ''sDObj = new Date(y,m,i+1)
                ''lDObj = new Lunar(sDObj)
                sDOj = DateSerial(y, m, i)
                Syerp = Year(sDOj)
                Smohp = Month(sDOj)
                Sdatp = Day(sDOj)
                thfsw = DatePart("w", sDOj) - 1
                lDOj = Lunar(Syerp, Smohp, Sdatp)
                lDOjv = Split(lDOj, ";")
                Ly = lDOjv(0)
                Lm = lDOjv(1)
                Ld = lDOjv(2)
                Lp = lDOjv(3)
                If (Lp = "True") Then
                    Lx = leapDays(Ly)
                Else
                    Lx = LmonthDays(Ly, Lm)
                End If
                If (n = 0) Then
                    firstLM = Lm
                    ''Ldpos[n++] = i-Ld+1
                End If
                '' end if
        
                ' if(m==1 && (i+1)==term2) Cy=GanZhi(y-1912+48);
                '  if((i+1)==firstNode) Jm = GanZhi((y-1912)*12+(m-1)+37);
                'Cm= GanZhi((Ly-1912)*12+Lm+37);
                '  Cd = GanZhi(dayCyclical+i);
    
                If ((m - 1) = 1 And i = CInt(term2)) Then
                    Cy = GanZhi(y - 1912 + 48)
                End If
                If (i = CInt(firstNode)) Then
                    ''Jm = GanZhi((y-1912)*12+m+37)
                    Cm = GanZhi((y - 1912) * 12 + (m - 1) + 37)
                End If
                '' Cm= GanZhi((Ly-1912)*12+Lm+37)
                Cd = GanZhi(DCLD + i - 1)
    
                ''' this[i] = new calElement(y,m+1,i+1,dStr1[(i+this.firstWeek)%7],
                '''                        Ly,Lm,Ld++,Lp,Cy,Cm,Jm,Cd);
                Tcalary(m, i, 0) = y
                Tcalary(m, i, 1) = m
                Tcalary(m, i, 2) = i
                Tcalary(m, i, 3) = thfsw
                Tcalary(m, i, 4) = Ly
                Tcalary(m, i, 5) = Lm
                Tcalary(m, i, 6) = Ld
                Tcalary(m, i, 7) = Lp
                Tcalary(m, i, 8) = Cy
                Tcalary(m, i, 9) = Cm
                Tcalary(m, i, 10) = Cd
                '' Tcalary(m,i,11)=Jm
            Next
 
            '' tmp1=sTerm(y,m*2  )-1;
            '' tmp2=sTerm(y,m*2+1)-1;
            ''this[tmp1].solarTerms = SolarTerm[m*2];
            '' this[tmp2].solarTerms = SolarTerm[m*2+1];
            ''  if(m==3) this[tmp1].color = 'red';

            ''Tcalendar="<國月>"&thisln&"<農月>"&Ld&lDOJV(2)&"<日期>"&Lx&Lp&Lpp
            '' Tcalendar="<測試期>"&Tcalary(m,21,6)&"<測農期>"&Tcalary(m,21,4)&Tcalary(m,21,5)&Tcalary(m,21,6)&"<全月日數>"&thisln&"<BR>"
            Dim Tcalendar1 = "<測國期>" & Tcalary(m, dx, 0) & "/" & Tcalary(m, dx, 1) & "/" & Tcalary(m, dx, 2) & "<星期>" & Tcalary(m, dx, 3) & "<BR>"
            Dim Tcalendar2 = "<測農期>" & Tcalary(m, dx, 4) & "/" & Tcalary(m, dx, 5) & "/" & Tcalary(m, dx, 6) & Tcalary(m, dx, 7) & "<年月日干支>" & Tcalary(m, dx, 8) & Tcalary(m, dx, 9) & Tcalary(m, dx, 10) & "<BR>"
            Dim Tcalendar3 =  Tcalary(m, dx, 8) & Tcalary(m, dx, 9) & Tcalary(m, dx, 10)
            '' Tcalendar = Tcalendar1 + Tcalendar2
            Tcalendar = Tcalendar3
            '' Response.write(  Tcalendar(2012,4,6))
        End Function
 
        ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
  </script>
 <script Language="VB" runat="server">
   
    
     '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
     Function jqTrm(y, nn)
         ''term2=ssTerm(y,2)  ''''立春日''''
         ''firstNode = ssTerm(y,(m-1)*2)   ''''當月的首節氣為幾日''''
         ''firstNode = ssTerm(y,(m-1)*2)   ''''當月的首節氣為幾日''''
         ''term2 = '(y, 2 + 1)  ''''立春''''
         '' firstNode = '(y, (m - 1) * 2 + 1)   ''''當月的首節氣為幾日''''
         ''Dim cljqtbl() = {"年度","小寒", "大寒", "立春", "雨水", "驚蟄","春分", "清明", "穀雨", "立夏", "小滿", "芒種", "夏至", "小暑", "大暑", "立秋", "處暑", "白露", "秋分", "寒露", "霜降", "立冬", "小雪", "大雪", "冬至"}
         Dim DYNUM, DMNUM, DDNUM, DHNUM, DATjg2
         Dim Rowk
         Dim yx = y
         Dim nx = nn
         
         Rowk = jqtrmd(yx, nx - 1)
         '' DYNUM = Mid(Rowk, 4, 4)
         '' DMNUM = Mid(Rowk, 9, 2)
         DDNUM = Mid(Rowk, 12, 2)
         '' sDos = DateSerial(y, nn, dd)
         ''DATjg2 = DateSerial(DYNUM, DMNUM, DDNUM)
         DATjg2 = DDNUM
         ' sDow2 = DateSerial(y, 12, termw2)
         '' DCLDw2 = DateDiff("d", D2D, sDow2) + 12 
         
         ' Return Rowk
         '' Response.Write (Rowk)
         Return DATjg2
     End Function
     
     
     Function jqTmd(y, nn)
         ''term2=ssTerm(y,2)  ''''立春日''''
         ''firstNode = ssTerm(y,(m-1)*2)   ''''當月的首節氣為幾日''''
         ''firstNode = ssTerm(y,(m-1)*2)   ''''當月的首節氣為幾日''''
         ''term2 = '(y, 2 + 1)  ''''立春''''
         '' firstNode = '(y, (m - 1) * 2 + 1)   ''''當月的首節氣為幾日''''
         ''Dim cljqtbl() = {"年度","小寒", "大寒", "立春", "雨水", "驚蟄","春分", "清明", "穀雨", "立夏", "小滿", "芒種", "夏至", "小暑", "大暑", "立秋", "處暑", "白露", "秋分", "寒露", "霜降", "立冬", "小雪", "大雪", "冬至"}
         Dim DYNUM, DMNUM, DDNUM, DHNUM, DATjg1
         Dim Rowk
         Dim yx = y
         Dim nx = nn
         
         Rowk = jqtrmd(yx, nx - 1)
         DYNUM = Mid(Rowk, 4, 4)
         DMNUM = Mid(Rowk, 9, 2)
         DDNUM = Mid(Rowk, 12, 2)
         '' sDos = DateSerial(y, nn, dd)
         DATjg1 = DateSerial(DYNUM, DMNUM, DDNUM)
         ' sDow2 = DateSerial(y, 12, termw2)
         '' DCLDw2 = DateDiff("d", D2D, sDow2) + 12 
         ' Return Rowk
         '' Response.Write (Rowk)
         Return DATjg1
     End Function
 
    
     
     '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
     Function initd()
         '' Dim LKGunar = Tcalendar(KGyern, KGmohn, KGdatn)
         Dim YNUMm = YNUM.SelectedItem.Text
         Dim MNUMm = MNUM.SelectedItem.Text
         Dim DNUMm = DNUM.SelectedItem.Text
         Dim HNUMm = HNUM.SelectedItem.Text
         Dim LLeapm = LLeap.SelectedItem.Text
         Dim SEXm = Sex.SelectedItem.Text
         ''Dim Lyern,Lmohn,Ldatn,Leaph
         ''Dim KGLunar,KGPLunar ,KGyern,KGmohn,KGdatn,KGdlep 
         Dim Lyern = CInt(YNUMm)
         Dim Lmohn = CInt(MNUMm)
         Dim Ldatn = CInt(DNUMm)
         Dim Leaph = LLeapm
         Dim Sexph = SEXm
         ''Dim Leaph="false"
         ''Dim KGLunar,KGPLunar ,KGyern,KGmohn,KGdatn,KGdlep 
         Dim KGLunar = KLnar(Lyern, Lmohn, Ldatn, Leaph)
         '' KGLunar=KLnar(Syerng,Smohng,Sdatng,"false")
         Dim KGPLunar = Split(KGLunar, ";")
         Dim KGyern = CInt(KGPLunar(1))
         Dim KGmohn = CInt(KGPLunar(2))
         Dim KGdatn = CInt(KGPLunar(3))
         Dim KGdlep = KGPLunar(4)
  
         ''Dim LKGunar=Tcalendar(Syerng,Smohng,Sdatng )
         Dim LKGunar = Tcalendar(KGyern, KGmohn, KGdatn)
         '' Response.Write(KGLunar)
         '' Response.Write(LKGunar)
         '' firstNode = '(y,(m-1)*2+1)   ''''當月的首節氣為幾日
         ''Dim SPND1 = spnTmd(KGyern, (KGmohn - 1) * 2 + 1, KGdatn)
         Dim SPNDO, SPNDF, SPNDB
         ''sDow1 = DateSerial(DYNUM, DMNUM, DDNUM)
         ' DCLDw1 = DateDiff("d", D2D, sDow1) + 12
         Dim i, kno, knf, knb, DADff1, DADff2 As Integer
         Dim DADfb
         knf = (KGmohn - 1) * 2 - 1
         kno = (KGmohn - 1) * 2 + 1
         knb = (KGmohn - 1) * 2 + 3
         SPNDO = DateSerial(KGyern, KGmohn, KGdatn)
         If DateSerial(KGyern, KGmohn, KGdatn) <= jqTmd(KGyern, kno) Then
             If knf < 0 Then
                 SPNDF = jqTmd(KGyern - 1, 23)
                 SPNDB = jqTmd(KGyern, kno)
             Else
                 SPNDF = jqTmd(KGyern, knf)
                 SPNDB = jqTmd(KGyern, kno)
             End If
          
         Else
           
             If knb > 23 Then
                 SPNDF = jqTmd(KGyern, kno)
                 SPNDB = jqTmd(KGyern + 1, 1)
             Else
                 SPNDF = jqTmd(KGyern, kno)
                 SPNDB = jqTmd(KGyern, knb)
             End If
         End If
         DADff1 = DateDiff("d", SPNDF, SPNDO)
         DADff2 = DateDiff("d", SPNDO, SPNDB)
         DADfb = Trim(DADff1) & ":" & Trim(DADff2)
         '' Response.Write(DADfb)
         Return DADfb
     End Function
     '''  ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
     
     Function jqtrmd(in1, k)
         ''//document.getElementById("in1").value=yr
         '' Dim ptsa() = {485, 203, 199, 182, 156, 136, 77, 74, 70, 58, 52, 50, 45, 44, 29, 18, 17, 16, 14, 12, 12, 12, 9, 8}
         '' Dim ptsb() = {324.96, 337.23, 342.08, 27.85, 73.14, 171.52, 222.54, 296.72, 243.58, 119.81, 297.17, 21.02, 247.54, 325.15, 60.93, 155.12, 288.79, 198.04, 199.76, 95.39, 287.11, 320.81, 227.73, 15.45}
         ''  Dim ptsc() = {1934.136, 32964.467, 20.186, 445267.112, 45036.886, 22518.443, 65928.934, 3034.906, 9037.513, 33718.147, 150.678, 2281.226, 29929.562, 31555.956, 4443.417, 67555.328, 4562.452, 62894.029, 31436.921, 14577.848, 31931.756, 34777.259, 1222.114, 16859.074}
         Dim jq() = {"春分", "清明", "穀雨", "立夏", "小滿", "芒種", "夏至", "小暑", "大暑", "立秋", "處暑", "白露", "秋分", "寒露", "霜降", "立冬", "小雪", "大雪", "冬至", "小寒", "大寒", "立春", "雨水", "驚蟄"}
         '' ' Function jieqi(inl,k)
         Dim i, ptb, dt
         Dim ini = 0, num = 26
         ''Dim yr = txt1.Text - 0
         Dim yr = in1 - 0
         If (yr < -7000 Or yr > 7000) Then
             ''' alert("超出&#35745算能力")
             Response.Write("超出&#35745算能力")
             ''  Return False
         End If

         If (yr < -1000 Or yr > 3000) Then
             Response.Write("适用于西元-1000年至西元3000年，超出此范&#22260&#35823差&#36739大")
         End If
         Dim jdez(30)
         Dim jdjq(26)
         Dim jdpjq(26)
         Dim jdpjqt
         Dim jqc(26)
         Dim jt(26)
         Dim jqcd(26), jtd(26)
         Dim out = ""
         Dim jd = VE(yr)
         Dim ty = VE(yr + 1) - jd
         ''jdez = MeanJQJD(yr, jd, ty, 0, 30)
         ''jdjq = Genltor(yr, 0, 26)
         ''Response.Write(jdjq(5)& "</br>")
         '' jdpjq= GetPureJQsinceSpring(yr, ptsa, ptsb, ptsc, jdpjq)
         jdpjq = GetPureJQsinceSpring(yr)
         ''//for(i=0;i<12 ;i++)
         ''//jqc=jq((2*i+21) mod 24)+":"
         For i = 0 To 24
             jqc(i) = jq((i + 19) Mod 24)
             jt(i) = Jtime(False, jdpjq(i))
             out = out & jqc(i) & jt(i) & ":"
             jqcd(i) = jq((i + 19) Mod 24) + ":"
             jtd(i) = Jtime(False, jdpjq(i))
             '' Response.Write("tsttt" & jdez(i))
         Next
         ''Return out
         '' Response.Write(out & "</br>")
         Return jqcd(k) & jtd(k)
         ''// Dim hiddenControl = '< = inpHide.ClientID mod >'
         ''// document.getElementById(hiddenControl).value = out
         '' //return jqcd[k]+jtd[k]'''[ ] in javascript 
         '' //show1.innerText=out	//for IE
         ''//show1.textContent=out	//for mozilla
     End Function
     '' %>'''<script runat="///server" >
     
     Function VE(yy)  ''//&#35745算指定年的春分&#28857
         Dim yx = yy
         Dim m
         Dim Jdve
         If (yx >= 1000 Or yx <= 8001) Then
             m = (yx - 2000) / 1000
             Jdve = 2451623.80984 + 365242.37404 * m + 0.05169 * m * m - 0.00411 * m * m * m - 0.00057 * m * m * m * m
    
         Else
             If (yx >= -8000 Or yx < 1000) Then
                 m = yx / 1000
                 Jdve = 1721139.29189 + 365242.1374 * m + 0.06134 * m * m + 0.00111 * m * m * m - 0.00071 * m * m * m * m
        
             Else
                 Response.Write("超出&#35745算能力范&#22260")
                 Return False
             End If
         End If
         Return Jdve
     End Function

     Function MeanJQJD(yy, jdve, ty, ini, num)
         Dim ath = 2 * Math.PI / 24
         Dim tx = (jdve - 2451545) / 365250
         Dim e = 0.0167086342 - 0.0004203654 * tx - 0.0000126734 * tx * tx + 0.0000001444 * tx * tx * tx - 0.0000000002 * tx * tx * tx * tx + 0.0000000003 * tx * tx * tx * tx * tx
         Dim tt = yy / 1000
         Dim vp = 111.25586939 - 17.0119934518333 * tt - 0.044091890166673 * tt * tt - 0.000437356166661345 * tt * tt * tt + 0.00000816716666602386 * tt * tt * tt * tt
         Dim rvp = vp * 2 * Math.PI / 360
         Dim peri(30)
         Dim i
         Dim jdezr(30)
         For i = 1 To (ini + num)
             Dim flag = 0
             Dim th = ath * (i - 1) + rvp
             If (th > Math.PI And th <= 3 * Math.PI) Then
                 th = 2 * Math.PI - th
                 flag = 1
             End If
             If (th > 3 * Math.PI) Then
                 th = 4 * Math.PI - th
                 flag = 2
             End If
             Dim f1 = 2 * Math.Atan((Math.Sqrt((1 - e) / (1 + e)) * Math.Tan(th / 2)))
             Dim f2 = (e * Math.Sqrt(1 - e * e) * Math.Sin(th)) / (1 + e * Math.Cos(th))
             Dim f = (f1 - f2) * ty / 2 / Math.PI
             If (flag = 1) Then
                 f = ty - f
             End If
             If (flag = 2) Then
                 f = 2 * ty - f
               
             End If
             peri(i) = f
         Next
         For i = ini To (ini + num)
             jdezr(i) = jdve + peri(i) - peri(1)
             '' Response.Write(jdezr(i))
         Next
         ''Return True
         Return jdezr
     End Function
   

     Function Perturbation(jdez)
         Dim ptsa() = {485, 203, 199, 182, 156, 136, 77, 74, 70, 58, 52, 50, 45, 44, 29, 18, 17, 16, 14, 12, 12, 12, 9, 8}
         Dim ptsb() = {324.96, 337.23, 342.08, 27.85, 73.14, 171.52, 222.54, 296.72, 243.58, 119.81, 297.17, 21.02, 247.54, 325.15, 60.93, 155.12, 288.79, 198.04, 199.76, 95.39, 287.11, 320.81, 227.73, 15.45}
         Dim ptsc() = {1934.136, 32964.467, 20.186, 445267.112, 45036.886, 22518.443, 65928.934, 3034.906, 9037.513, 33718.147, 150.678, 2281.226, 29929.562, 31555.956, 4443.417, 67555.328, 4562.452, 62894.029, 31436.921, 14577.848, 31931.756, 34777.259, 1222.114, 16859.074}
           
         Dim t = (jdez - 2451545) / 36525
         Dim s = 0
         Dim k
         For k = 0 To 23
             s = s + ptsa(k) * Math.Cos(ptsb(k) * 2 * Math.PI / 360 + ptsc(k) * 2 * Math.PI / 360 * t)
         Next
         Dim w = 35999.373 * t - 2.47
         Dim l = 1 + 0.0334 * Math.Cos(w * 2 * Math.PI / 360) + 0.0007 * Math.Cos(2 * w * 2 * Math.PI / 360)
         Dim ptb = 0.00001 * s / l
         Return ptb
     End Function
     Function DeltaT(yy, mm)
         Dim u, t, dt, y
         y = yy + (mm - 0.5) / 12

         If (y <= -500) Then
             u = (y - 1820) / 100
             dt = (-20 + 32 * u * u)
         ElseIf (y < 500) Then
             u = y / 100
             dt = (10583.6 - 1014.41 * u + 33.78311 * u * u - 5.952053 * u * u * u - 0.1798452 * u * u * u * u + 0.022174192 * u * u * u * u * u + 0.0090316521 * u * u * u * u * u * u)
         ElseIf (y < 1600) Then
             u = (y - 1000) / 100
             dt = (1574.2 - 556.01 * u + 71.23472 * u * u + 0.319781 * u * u * u - 0.8503463 * u * u * u * u - 0.005050998 * u * u * u * u * u + 0.0083572073 * u * u * u * u * u * u)
         ElseIf (y < 1700) Then
             t = y - 1600
             dt = (120 - 0.9808 * t - 0.01532 * t * t + t * t * t / 7129)
         ElseIf (y < 1800) Then
             t = y - 1700
             dt = (8.83 + 0.1603 * t - 0.0059285 * t * t + 0.00013336 * t * t * t - t * t * t * t / 1174000)
         ElseIf (y < 1860) Then
             t = y - 1800
             dt = (13.72 - 0.332447 * t + 0.0068612 * t * t + 0.0041116 * t * t * t - 0.00037436 * t * t * t * t + 0.0000121272 * t * t * t * t * t - 0.0000001699 * t * t * t * t * t * t + 0.000000000875 * t * t * t * t * t * t * t)
         ElseIf (y < 1900) Then
             t = y - 1860
             dt = (7.62 + 0.5737 * t - 0.251754 * t * t + 0.01680668 * t * t * t - 0.0004473624 * t * t * t * t + t * t * t * t * t / 233174)
         ElseIf (y < 1920) Then
             t = y - 1900
             dt = (-2.79 + 1.494119 * t - 0.0598939 * t * t + 0.0061966 * t * t * t - 0.000197 * t * t * t * t)
         ElseIf (y < 1941) Then
             t = y - 1920
             dt = (21.2 + 0.84493 * t - 0.0761 * t * t + 0.0020936 * t * t * t)
         ElseIf (y < 1961) Then
             t = y - 1950
             dt = (29.07 + 0.407 * t - t * t / 233 + t * t * t / 2547)
         ElseIf (y < 1986) Then
             t = y - 1975
             dt = (45.45 + 1.067 * t - t * t / 260 - t * t * t / 718)
         ElseIf (y < 2005) Then
             t = y - 2000
             dt = (63.86 + 0.3345 * t - 0.060374 * t * t + 0.0017275 * t * t * t + 0.000651814 * t * t * t * t + 0.00002373599 * t * t * t * t * t)
         ElseIf (y < 2050) Then
             t = y - 2000
             dt = (62.92 + 0.32217 * t + 0.005589 * t * t)
         ElseIf (y < 2150) Then
             u = (y - 1820) / 100
             dt = (-20 + 32 * u * u - 0.5628 * (2150 - y))
         Else
             u = (y - 1820) / 100
             dt = (-20 + 32 * u * u)
         End If

         If (y < 1955 Or y >= 2005) Then
             dt = dt - (0.000012932 * (y - 1955) * (y - 1955))
         End If
         Dim DltaT = dt / 60    ''//將秒轉換為分
         Return DltaT
     End Function

     Function Jtime(op, jd)   ''//&#23558儒略日&#36716&#25442&#20026年月日&#26102分秒
         '' Dim jdt = Fix(jd)
         Dim y4h, init
         If (jd >= 2299160.5 Or op) Then
             y4h = 146097
             init = 1721119.5
         Else
             y4h = 146100
             init = 1721117.5
         End If
         Dim jdr = Fix(jd - init)
         Dim yh = y4h / 4
         Dim cen = Fix((jdr + 0.75) / yh)
         Dim d = Fix(jdr + 0.75 - cen * yh)
        
         Dim ywl = 1461 / 4
         Dim jy = Fix((d + 0.75) / ywl)
         d = Fix(d + 0.75 - ywl * jy + 1)
         Dim ml = 153 / 5
         Dim mp = Fix((d - 0.5) / ml)
         d = Fix((d - 0.5) - 30.6 * mp + 1)
         Dim y = (100 * cen) + jy
         Dim m = ((mp + 2) Mod 12) + 1
         If (m < 3) Then
             y = y + 1
         End If
         Dim sd = Fix((jd + 0.5 - Fix(jd + 0.5)) * 24 * 60 * 60 + 0.00005)
         Dim mt = Fix(sd / 60)
         Dim ss = sd Mod 60
         Dim hh = Fix(mt / 60)
         Dim mmt = mt Mod 60
         Dim yy = Fix(y)
         Dim mm = Fix(m)
         Dim dd = Fix(d)
         '' Dim yc = "     " + yy
         '' Dim ln = Len(yc)
         ''yc = Right(yc, 5)
         Dim dytm = yy
         dytm = dytm & "年"
         ''dytm+= ((mm < 10) ? "0" : "") + mm+"月"
         ''dytm+= ((dd < 10) ? "0" : "") + dd+"日"
         If (mm < 10) Then
             dytm = dytm & "0" & mm & "月"
         Else
             dytm = dytm & "" & mm & "月"
         End If
         If (dd < 10) Then
             dytm = dytm & "0" & dd & "日"
         Else
             dytm = dytm & "" & dd & "日"
         End If
         ''//dytm= ((hh < 10) ? "0" : "") + hh+"&#26102"
         ''// dytm= ((mmt < 10) ? "0" : "") + mmt+"分"
         '' //dytm= ((ss < 10) ? "0" : "") + ss+"秒"
 
         Return dytm
         ''Return jdt
         '' Return d

     End Function
     ''//副程式功能：對Perturbaton作調整後的自春分點開始的24節氣,可只取部份
     Function Genltor(yy, ini, num)
         Dim jdezt(30)
         Dim jdjqr(26)
         Dim i, ptb, dt
         Dim veb = VE(yy)
         Dim ty = VE(yy + 1) - veb    '' //求指定年的春分點及回歸年長
         ''If (MeanJQJD(yy, veb, ty, ini, num) = True) Then   ''	//輸入指定年,JD,回歸年長,求該回歸年各節氣之長
         jdezt = MeanJQJD(yy, veb, ty, ini, num)
         For i = (ini + 1) To (ini + num)
             ptb = Perturbation(jdezt(i))    ''''//取得受perturbation影響所需微調
             dt = DeltaT(yy, Fix(i / 2) + 3)  ''//修正dynamical time to Universal time
             jdjqr(i) = jdezt(i) + ptb - dt / 60 / 24    ''//加上攝動調整值ptb，減去對應的Delta T值(分鐘轉換為日)
             jdjqr(i) = jdjqr(i) + 1 / 3  '''//因中國時間比格林威治時間先行8小時，即1/3日
         Next
         ''End If
         Return jdjqr
     End Function
    

     ''//副程式功能：對Perturbaton作調整後的自春分點開始的24節氣,可只取部份
     ''//副程式功能：求出以立春點開始的不含中氣之12節氣
     ''Function GetPureJQsinceSpring(yy, ptsa, ptsb, ptsc, jdpjq)
     Function GetPureJQsinceSpring(yy)
         Dim i
         Dim jdpjqr(26)
         ''Dim sjdjq(26)
         Dim sjdjqa(26)
         Dim sjdjqb(26)
         Dim yea = yy - 1
         '' //GetAdjustedJQ(yea, 21, 3, sjdjq)   //求出含指定年立春開始之3個節氣JD值,以前一年的年值代入
         ''//轉移春分前之立春至驚蟄之節氣至jdpjq變數中，以重整index
         ''//jdpjq[0] =sjdjq[22] jdpjq[1] =sjdjq[24]   //原此為立春 //此為驚蟄
         'Function GetPureJQsinceSpring(yy, ptsa, ptsb, ptsc, jdpjq)  ''//求出含指定年小寒開始之5個節氣JD值,以前一年的年值代入
         sjdjqa = Genltor(yea, 19, 5)
         jdpjqr(0) = sjdjqa(20)
         jdpjqr(1) = sjdjqa(21)
         jdpjqr(2) = sjdjqa(22)
         jdpjqr(3) = sjdjqa(23)
         jdpjqr(4) = sjdjqa(24)

         yea = yy
         sjdjqb = Genltor(yea, 0, 26)   ''' //求出指定年節氣之JD值,從驚蟄開始，到雨水
         ''//轉移春分至小寒之節氣至jdpjq變數中，以重整index
         ''//for(i=1i<=13i++){
         ''//jdpjq(i+1) = sjdjq(2 * i)
         For i = 1 To 20
             jdpjqr(i + 4) = sjdjqb(i)
         Next
         Return jdpjqr
     End Function
 
     
  </script>
   
   <%
       
       '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
  ' Dim Syern,Smohn,Sdatn,Seaph
   ' Syern=Cint(YNUM)
   ' Smohn=Cint(MNUM)
   ' Sdatn=Cint(DNUM)
       ' Seaph=LLeap
       ''Dim Lyern,Lmohn,Ldatn,Leaph
       ''Dim Lyern,Lmohn,Ldatn,Leaph
       ''Dim KGLunar,KGPLunar ,KGyern,KGmohn,KGdatn,KGdlep 
       Dim Lyern = CInt(YNUMm)
       Dim Lmohn = CInt(MNUMm)
       Dim Ldatn = CInt(DNUMm)
       Dim Leapp = Leapm
       ''Dim Leaph="false"
  
       ''Dim KGLunar,KGPLunar ,KGyern,KGmohn,KGdatn,KGdlep 
       Dim KGLunar = KLnar(Lyern, Lmohn, Ldatn, Leapp)
       '' KGLunar=KLnar(Syerng,Smohng,Sdatng,"false")
       '' KGLunar=KLnar(KSyern,KSmohn,KSdatn,KSdlep)
       Dim KGPLunar = Split(KGLunar, ";")
       Dim KGyern = CInt(KGPLunar(1))
       Dim KGmohn = CInt(KGPLunar(2))
       Dim KGdatn = CInt(KGPLunar(3))
       Dim KGdlep = KGPLunar(4)
  
       ''Dim LKGunar=Tcalendar(Syerng,Smohng,Sdatng )
       '' Dim LKGunar=Tcalendar(2012,2,14)
       Dim LKGunar = Tcalendar(KGyern, KGmohn, KGdatn)
 
       Response.Write(KGLunar)
       Response.Write(LKGunar)

       
       ''''''''''''''''''''''''''''''''''''''''''''''''''''''''  
       Dim DDA3, DDD3, MnD3, DT113, DT23, DDtD3
       ''DT11=  #02/17/1912#
       DT113 = #1/1/1912#
       ''DT22=DateSerial(Syern,Smohn,Sdatn)
       DT23 = DateSerial(KGyern, KGmohn, KGdatn)
       ''DYY=DateDiff("yyyy", D1, D2t)
       DDtD3 = DateDiff("d", DT113, DT23)
       Dim TLYMDS3
    
       TLYMDS3 = LYMDS(Lyern, Lmohn, Ldatn, Leapp)
       ''TLYMDS3 =LYMDS( Syerng,Smohng,Sdatng,Leapg)
       ''  Response.write "農總日"&(TLYMDS+47)&"<br>"
       '' Response.Write("農總日" & (TLYMDS3 + 47))
      '' Response.Write("國總日" & (DDtD3) & "<br>")
       Dim TOETA() = {"轸", "角", "亢", "氐", "房", "心", "尾", "箕", "斗", "牛", "女", "虚", "危", "室", "壁", _
          "奎", "娄", "胃", "昴", "毕", "觜", "参", "井", "鬼", "柳", "星", "张", "翼", "轸"}
       Dim TOETT = TOETA((DDtD3 + 19) Mod 28)
       '' Response.Write("二八星宿:" & TOETT & "<br>")
       ''Dim  Cssterm= ssTerm(1930 ,1) 
       Dim Cjqtrm = jqTrm(KGyern, (KGmohn - 1) * 2 + 1)
       ''  Response.Write(Cjqtrm)
       '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''  
      
       
   %>
   
<script type="text/javascript">
    function ACTjieqi() {
        var actout = "";
        var pgout;
        var ctn, pgy, pgm, pgd, pgl;
        var K, k0, k1, k2;
        //var k2=0;
        // var actx As Array
        ctn = document.getElementById('<%= YNUM.ClientID%>').value;
        k0 = parseInt(ctn);
        k1 = k0 - 1;
        k2 = k0 + 2;
        //cldt = new calendar(SYY,SMM);
        for (k = k1; k < k2; k++) {
            // // actx[k]= jieqi(k,1);
            //actout += jieqi(k,1) ;
            //  cldt[(k-1900)] = jieqi(k,1);
            //clds[i] =cldt[i];
        }

        pgy = parseInt(document.getElementById('<%= YNUM.ClientID%>').value);
    pgm = parseInt(document.getElementById('<%= MNUM.ClientID%>').value);
        pgd = parseInt(document.getElementById('<%= DNUM.ClientID%>').value);
        pgl = document.getElementById('<%= LLeap.ClientID%>').value;
        pgout = Lunar2Solar(pgy, pgl, pgm, pgd);
       // pgout = jdays(false,2012,12,31,12);
        //pgout = Lunar2Solar(2011,false,3,1);
        // (Lunar2Solar(yp, cjmp, mp, dp));
        var hiddenControl = '<%= inpHide.ClientID%>';
        //document.getElementById(hiddenControl).value = actout;
     document.getElementById(hiddenControl).value = pgout;
 }
    </script>
  
  <script type="text/javascript">
      var synmonth = 29.530588853;     //synodic month (new Moon to new Moon)
      var ptsa = new Array(485, 203, 199, 182, 156, 136, 77, 74, 70, 58, 52, 50, 45, 44, 29, 18, 17, 16, 14, 12, 12, 12, 9, 8)
      var ptsb = new Array(324.96, 337.23, 342.08, 27.85, 73.14, 171.52, 222.54, 296.72, 243.58, 119.81, 297.17, 21.02, 247.54, 325.15, 60.93, 155.12, 288.79, 198.04, 199.76, 95.39, 287.11, 320.81, 227.73, 15.45)
      var ptsc = new Array(1934.136, 32964.467, 20.186, 445267.112, 45036.886, 22518.443, 65928.934, 3034.906, 9037.513, 33718.147, 150.678, 2281.226, 29929.562, 31555.956, 4443.417, 67555.328, 4562.452, 62894.029, 31436.921, 14577.848, 31931.756, 34777.259, 1222.114, 16859.074)
      var zq = new Array;

      var jdez = new Array;
      var jdjq = new Array;
      var jdnmn = new Array;
      var zr = new Array, sjd = new Array, mc = new Array;

      function Lunar2Solar(in1, ckjm, in2, in3) {	//此為將陰曆日期轉換為陽曆日期的主程式
          //共用的各變數
          var yy, mm, dd, hh, mt, ss;
          //陽曆的各變數
          var zr = new Array, op = false;
          //陰曆的各變數
          var sjd = new Array, mc = new Array, lsjd, renyue;
          var nofd = new Array, er, jdx, mx;
          //求算以立春為起點的一年中節氣
          //var yea=in1.value-0;	//取得年之輸入值
          //var chk=ckb.checked;	//取得閏月與否
          //var mxa=in2.value-0;	//取得月之輸入值
          //var dx=in3.value-0;	//取得日之輸入值
          var yea = in1 - 0;	//取得年之輸入值
          var chk = ckjm;	//取得閏月與否
          var mxa = in2 - 0;	//取得月之輸入值
          var dx = in3 - 0;	//取得日之輸入值

          var out = "";
          //限定範圍
          if (yea < -7000 || yea > 7000) {
              alert("超出計算能力");
              return false;
          }
          if (yea < -1000 || yea > 3000) {
              alert("适用于西元-1000年至西元3000年，超出此范&#22260;&#35823;差&#36739;大");
          }
          GetZQandSMandLunarMonthCode(op, yea, zr, sjd, mc);

          renyue = 0;      //若閏月旗標為0代表無閏月
          for (j = 1; j <= 14; j++) {	//確認指定年前一年11月開始各月是否閏月
              if (mc[j] - Math.floor(mc[j]) > 0) {          //若是，則將此閏月代碼放入閏月旗標內
                  renyue = Math.floor(mc[j] + 0.5);
                  //renyue=0對應陰曆11月,1對應陰曆12月，2對應陰曆隔年1月，依此類推。
                  break;
              }
          }

          mx = mxa + 2;	//11月對應到1，12月對應到2，1月對應到3，2月對應到4，依此類推
          //求算陰曆各月之大小，大月30天，小月29天
          for (i = 0; i <= 14; i++) {
              nofd[i] = Math.floor(sjd[i + 1] + 0.5) - Math.floor(sjd[i] + 0.5);	//每月天數,加0.5是因JD以正午起算
          }

          er = 0;	//若輸入值有錯誤，er值將被設定為1
          if (mx >= 3 && mx <= 14) {	//輸入月份必須在1-12月之內
              if (dx >= 1 && dx <= 30) {	//輸入日期必須在1-30日之內
                //  if (chk == true) {	//若有用chekbox 勾選閏月
                  if (chk == "true") {	//若有用listbox 選閏月
                      if (renyue < 3) {	//而旗標非閏月或非本年閏月，則表示此年不含閏月
                          //renyue=0代表無閏月,=1代表閏月為前一年的11月,=2代表閏月為前一年的12月
                          er = 1;
                          alert("此年非閏年");
                      } else {                        //若本年內有閏月
                          if (renyue != mx) {	//但不為輸入的月份
                              er = 1;              //則此輸入的月份非閏月
                              alert("此月非閏月");
                          } else {                    //若輸入的月份即為閏月
                              if (dx <= nofd[mx]) {	//若輸入的日期不大於當月的天數
                                  jdx = sjd[mx] + dx - 1;	//則將當月之前的JD值加上日期之前的天數
                              } else {
                                  er = 1;
                                  alert("日期超出範圍");
                              }
                          }
                      }
                  } else {        //若沒有勾選閏月則
                      if (renyue == 0) {	//若旗標非閏月，則表示此年不含閏月(包括前一年的11月起之月份)
                          if (dx <= nofd[mx - 1]) {	//若輸入的日期不大於當月的天數
                              jdx = sjd[mx - 1] + dx - 1;     //則將當月之前的JD值加上日期之前的天數
                          } else {
                              er = 1;
                              alert("日期超出範圍");
                          }
                      } else {                //若旗標為本年有閏月(包括前一年的11月起之月份)
                          //公式nofd(mx - (mx > renyue) - 1)的用意為:若指定月大於閏月，則索引用mx，否則索引用mx-1
                          if (dx <= nofd[mx + (mx > renyue) - 1]) {	//若輸入的日期不大於當月的天數
                              jdx = sjd[mx + (mx > renyue) - 1] + dx - 1; //則將當月之前的JD值加上日期之前的天數
                          } else {
                              er = 1;
                              alert("日期超出範圍");
                          }
                      }
                  }
                  if (er == 0) {	//若沒有錯誤，則印出陽曆年月日
                      out +="陽曆";
                      out += Jtime(op, false, jdx);
                      //out += "\r\n";

                      // CLD.show1.innerText=out;	//for IE
                      // CLD.show1.textContent=out;	//for mozilla
                  }
              } else {
                  alert("日期錯誤");
              }
          } else {
              alert("月份錯誤");
          }

          return out;
          // CLD.show1.innerText=out;	//for IE
          // CLD.show1.textContent=out;	//for mozilla
      }


      function VE(yy) {//&#35745;算指定年的春分&#28857;
          var yx = yy;
          if (yx >= 1000 && yx <= 8001) {
              var m = (yx - 2000) / 1000;
              jdve = 2451623.80984 + 365242.37404 * m + 0.05169 * m * m - 0.00411 * m * m * m - 0.00057 * m * m * m * m;
          }
          else {
              if (yx >= -8000 && yx < 1000) {
                  m = yx / 1000;
                  jdve = 1721139.29189 + 365242.1374 * m + 0.06134 * m * m + 0.00111 * m * m * m - 0.00071 * m * m * m * m;
              }
              else {
                  alter("超出&#35745;算能力范&#22260;");
                  return false;
              }
          }
          return jdve
      }

      function MeanJQJD(yy, jdve, ty, ini, num) {
          var ath = 2 * Math.PI / 24;
          var tx = (jdve - 2451545) / 365250;
          var e = 0.0167086342 - 0.0004203654 * tx - 0.0000126734 * tx * tx + 0.0000001444 * tx * tx * tx - 0.0000000002 * tx * tx * tx * tx + 0.0000000003 * tx * tx * tx * tx * tx;
          var tt = yy / 1000;
          var vp = 111.25586939 - 17.0119934518333 * tt - 0.044091890166673 * tt * tt - 4.37356166661345E-04 * tt * tt * tt + 8.16716666602386E-06 * tt * tt * tt * tt;
          var rvp = vp * 2 * Math.PI / 360;
          var peri = new Array(30);
          var i;
          for (i = 1; i <= (ini + num) ; i++) {
              var flag = 0;
              var th = ath * (i - 1) + rvp;
              if (th > Math.PI && th <= 3 * Math.PI) {
                  th = 2 * Math.PI - th;
                  flag = 1;
              }
              if (th > 3 * Math.PI) {
                  th = 4 * Math.PI - th;
                  flag = 2;
              }
              var f1 = 2 * Math.atan((Math.sqrt((1 - e) / (1 + e)) * Math.tan(th / 2)));
              var f2 = (e * Math.sqrt(1 - e * e) * Math.sin(th)) / (1 + e * Math.cos(th));
              var f = (f1 - f2) * ty / 2 / Math.PI;
              if (flag == 1) f = ty - f;
              if (flag == 2) f = 2 * ty - f;
              peri[i] = f;
          }
          for (i = ini; i <= (ini + num) ; i++) {
              jdez[i] = jdve + peri[i] - peri[1];
          }
          return true;
      }

      function Perturbation(jdez) {
          var t = (jdez - 2451545) / 36525;
          var s = 0;
          for (k = 0; k <= 23; k++) {
              s = s + ptsa[k] * Math.cos(ptsb[k] * 2 * Math.PI / 360 + ptsc[k] * 2 * Math.PI / 360 * t);
          }
          var w = 35999.373 * t - 2.47;
          var l = 1 + 0.0334 * Math.cos(w * 2 * Math.PI / 360) + 0.0007 * Math.cos(2 * w * 2 * Math.PI / 360);
          var ptb = 0.00001 * s / l;
          return ptb;
      }

      function DeltaT(yy, mm) {
          var u, t, dt, y;
          y = yy + (mm - 0.5) / 12;

          if (y <= -500) {
              u = (y - 1820) / 100;
              dt = (-20 + 32 * u * u);
          }
          else {
              if (y < 500) {
                  u = y / 100;
                  dt = (10583.6 - 1014.41 * u + 33.78311 * u * u - 5.952053 * u * u * u - 0.1798452 * u * u * u * u + 0.022174192 * u * u * u * u * u + 0.0090316521 * u * u * u * u * u * u);
              }
              else {
                  if (y < 1600) {
                      u = (y - 1000) / 100;
                      dt = (1574.2 - 556.01 * u + 71.23472 * u * u + 0.319781 * u * u * u - 0.8503463 * u * u * u * u - 0.005050998 * u * u * u * u * u + 0.0083572073 * u * u * u * u * u * u);
                  }
                  else {
                      if (y < 1700) {
                          t = y - 1600;
                          dt = (120 - 0.9808 * t - 0.01532 * t * t + t * t * t / 7129);
                      }
                      else {
                          if (y < 1800) {
                              t = y - 1700;
                              dt = (8.83 + 0.1603 * t - 0.0059285 * t * t + 0.00013336 * t * t * t - t * t * t * t / 1174000);
                          }
                          else {
                              if (y < 1860) {
                                  t = y - 1800;
                                  dt = (13.72 - 0.332447 * t + 0.0068612 * t * t + 0.0041116 * t * t * t - 0.00037436 * t * t * t * t + 0.0000121272 * t * t * t * t * t - 0.0000001699 * t * t * t * t * t * t + 0.000000000875 * t * t * t * t * t * t * t);
                              }
                              else {
                                  if (y < 1900) {
                                      t = y - 1860;
                                      dt = (7.62 + 0.5737 * t - 0.251754 * t * t + 0.01680668 * t * t * t - 0.0004473624 * t * t * t * t + t * t * t * t * t / 233174);
                                  }
                                  else {
                                      if (y < 1920) {
                                          t = y - 1900;
                                          dt = (-2.79 + 1.494119 * t - 0.0598939 * t * t + 0.0061966 * t * t * t - 0.000197 * t * t * t * t);
                                      }
                                      else {
                                          if (y < 1941) {
                                              t = y - 1920;
                                              dt = (21.2 + 0.84493 * t - 0.0761 * t * t + 0.0020936 * t * t * t);
                                          }
                                          else {
                                              if (y < 1961) {
                                                  t = y - 1950;
                                                  dt = (29.07 + 0.407 * t - t * t / 233 + t * t * t / 2547);
                                              }
                                              else {
                                                  if (y < 1986) {
                                                      t = y - 1975;
                                                      dt = (45.45 + 1.067 * t - t * t / 260 - t * t * t / 718);
                                                  }
                                                  else {
                                                      if (y < 2005) {
                                                          t = y - 2000;
                                                          dt = (63.86 + 0.3345 * t - 0.060374 * t * t + 0.0017275 * t * t * t + 0.000651814 * t * t * t * t + 0.00002373599 * t * t * t * t * t);
                                                      }
                                                      else {
                                                          if (y < 2050) {
                                                              t = y - 2000;
                                                              dt = (62.92 + 0.32217 * t + 0.005589 * t * t);
                                                          }
                                                          else {
                                                              if (y < 2150) {
                                                                  u = (y - 1820) / 100;
                                                                  dt = (-20 + 32 * u * u - 0.5628 * (2150 - y));
                                                              }
                                                              else {
                                                                  u = (y - 1820) / 100;
                                                                  dt = (-20 + 32 * u * u);
                                                              }
                                                          }
                                                      }
                                                  }
                                              }
                                          }
                                      }
                                  }
                              }
                          }
                      }
                  }
              }
          }

          if (y < 1955 || y >= 2005) dt = dt - (0.000012932 * (y - 1955) * (y - 1955));
          var DeltaT = dt / 60;    //將秒轉換為分
          return DeltaT
      }

      function Jdays(op, yr, mh, dy, hr) {//將年月日時，轉&#25442;&#29234;儒略日
          if (yr < -400000 || yr > 400000) return false;
          var yp = yr + Math.floor((mh - 3) / 10);
          if (((yr > 1582) || (yr == 1582 && mh > 10) || (yr == 1582 && mh == 10 && dy >= 15)) || op) {
              var init = 1721119.5;
              var jdy = Math.floor(yp * 365.25) - Math.floor(yp / 100) + Math.floor(yp / 400);
          }
          else {
              if ((yr < 1582) || (yr == 1582 && mh < 10) || (yr == 1582 && mh == 10 && dy <= 4)) {
                  var init = 1721117.5;
                  var jdy = Math.floor(yp * 365.25);
              }
              else { return false; }
          }
          var mp = Math.floor(mh + 9) % 12;
          var jdm = mp * 30 + Math.floor((mp + 1) * 34 / 57);
          var jdd = dy - 1;
          var jdh = hr / 24;
          var jd = jdy + jdm + jdd + jdh + init;
          return jd;
      }

      function Jtime(op, op2, jd) {//&#23558;儒略日&#36716;&#25442;&#20026;年月日&#26102;分秒
          if (jd >= 2299160.5 || op) {
              var y4h = 146097;
              var init = 1721119.5;
          }
          else {
              var y4h = 146100;
              var init = 1721117.5;
          }
          var jdr = Math.floor(jd - init);
          var yh = y4h / 4;
          var cen = Math.floor((jdr + 0.75) / yh);
          var d = Math.floor(jdr + 0.75 - cen * yh);
          var ywl = 1461 / 4;
          var jy = Math.floor((d + 0.75) / ywl);
          d = Math.floor(d + 0.75 - ywl * jy + 1);
          var ml = 153 / 5;
          mp = Math.floor((d - 0.5) / ml);
          d = Math.floor((d - 0.5) - 30.6 * mp + 1);
          var y = (100 * cen) + jy;
          var m = (mp + 2) % 12 + 1;
          if (m < 3) y = y + 1;
          var sd = Math.floor((jd + 0.5 - Math.floor(jd + 0.5)) * 24 * 60 * 60 + 0.00005);
          var mt = Math.floor(sd / 60);
          var ss = sd % 60;
          var hh = Math.floor(mt / 60);
          var mmt = mt % 60;
          var yy = Math.floor(y);
          var mm = Math.floor(m);
          var dd = Math.floor(d);
          var yc = "     " + yy;
          yc = yc.substr(yc.length - 5, 5);
          var dytm = yc; dytm += "年";
          dytm += ((mm < 10) ? "0" : "") + mm + "月";
          dytm += ((dd < 10) ? "0" : "") + dd + "日";
          if (op2) {
              dytm += ((hh < 10) ? "0" : "") + hh + "&#26102;";
              dytm += ((mmt < 10) ? "0" : "") + mmt + "分";
              dytm += ((ss < 10) ? "0" : "") + ss + "秒";
          }
          //return dytm;
          return (dytm + SoLuGzJd(yy, mm, dd));
      }

      //副程式功能：對Perturbaton作調整後的自春分點開始的24節氣,可只取部份
      function GetAdjustedJQ(yy, ini, num, jdjq) {
          var veb = VE(yy);
          var ty = VE(yy + 1) - veb;     //求指定年的春分點及回歸年長

          if (MeanJQJD(yy, veb, ty, ini, num) == true) {	//輸入指定年,JD,回歸年長,求該回歸年各節氣之長
              for (i = ini + 1; i <= (ini + num) ; i++) {
                  ptb = Perturbation(jdez[i]);	//取得受perturbation影響所需微調
                  dt = DeltaT(yy, Math.floor(i / 2) + 3);	//修正dynamical time to Universal time
                  jdjq[i] = jdez[i] + ptb - dt / 60 / 24;	//加上攝動調整值ptb，減去對應的Delta T值(分鐘轉換為日)
                  jdjq[i] = jdjq[i] + 1 / 3;	//因中國時間比格林威治時間先行8小時，即1/3日
              }
          }

      }

      //副程式功能：求出自冬至點為起點的連續16個中氣
      function GetZQsinceWinterSolstice(yy, jdzq) {
          //求出以冬至為起點之連續16個中氣（多取四個以備用）
          var dj = new Array(26);
          GetAdjustedJQ(yy - 1, 18, 5, dj);	//求出指定年冬至開始之節氣JD值,以前一年的值代入
          //轉移春分前之節氣至jdzq變數中，以重整index
          jdzq[0] = dj[19];                    //此為冬至中氣
          jdzq[1] = dj[21];                    //此為大寒中氣
          jdzq[2] = dj[23];                    //此為雨水中氣
          GetAdjustedJQ(yy, 0, 26, dj); //求出指定年節氣之JD值
          for (i = 1; i <= 13; i++) {
              jdzq[i + 2] = dj[2 * i - 1];     //轉移冬至後之節氣至jdzq變數中，以重整index
          }
      }

      //副程式功能：對於指定日期時刻所屬的朔望月，求出其均值新月點的月序數
      function MeanNewMoon(jd) {
          var t, thejd, jdt;
          //k為從2000年1月6日14時20分36秒起至指定年月日之陰曆月數,以synodic month為單位
          var k = Math.floor((jd - 2451550.09765) / synmonth); //2451550.09765為2000年1月6日14時20分36秒之JD值。
          jdt = 2451550.09765 + k * synmonth;
          //Time in Julian centuries from 2000 January 0.5.
          t = (jdt - 2451545) / 36525;  //以100年為單位,以2000年1月1日12時為0點
          thejd = jdt + 0.0001337 * t * t - 0.00000015 * t * t * t + 0.00000000073 * t * t * t * t;
          //2451550.09765為2000年1月6日14時20分36秒，此為2000年後的第一個均值新月
          return k;
      }

      //函式功能:求出實際新月點
      //以2000年初的第一個均值新月點為0點求出的均值新月點和其朔望月之序數k
      //代入此副程式來求算實際新月點
      function TrueNewMoon(k) {
          var t, t2, t3, t4;
          var m, mprime, f, omega, es;
          var pt, apt1, apt2, jdt;
          jdt = 2451550.09765 + k * synmonth;
          t = (jdt - 2451545) / 36525;	//2451545為2000年1月1日正午12時的JD
          t2 = t * t;      //square for frequent use
          t3 = t2 * t;     //cube for frequent use
          t4 = t3 * t;     //to the fourth
          //mean time of phase
          pt = jdt + 0.0001337 * t2 - 0.00000015 * t3 + 0.00000000073 * t4;
          //Sun's mean anomaly(地球繞太陽運行均值近點角)(從太陽觀察)
          m = 2.5534 + 29.10535669 * k - 0.0000218 * t2 - 0.00000011 * t3;
          //Moon's mean anomaly(月球繞地球運行均值近點角)(從地球觀察)
          mprime = 201.5643 + 385.81693528 * k + 0.0107438 * t2 + 0.00001239 * t3 - 0.000000058 * t4;
          //Moon's argument of latitude(月球的緯度參數)
          f = 160.7108 + 390.67050274 * k - 0.0016341 * t2 - 0.00000227 * t3 + 0.000000011 * t4;
          //Longitude of the ascending node of the lunar orbit(月球繞日運行軌道升交點之經度)
          omega = 124.7746 - 1.5637558 * k + 0.0020691 * t2 + 0.00000215 * t3;
          //乘式因子
          es = 1 - 0.002516 * t - 0.0000074 * t2;
          //因perturbation造成的偏移：
          apt1 = -0.4072 * Math.sin((Math.PI / 180) * mprime);
          apt1 += 0.17241 * es * Math.sin((Math.PI / 180) * m);
          apt1 += 0.01608 * Math.sin((Math.PI / 180) * 2 * mprime);
          apt1 += 0.01039 * Math.sin((Math.PI / 180) * 2 * f);
          apt1 += 0.00739 * es * Math.sin((Math.PI / 180) * (mprime - m));
          apt1 -= 0.00514 * es * Math.sin((Math.PI / 180) * (mprime + m));
          apt1 += 0.00208 * es * es * Math.sin((Math.PI / 180) * (2 * m));
          apt1 -= 0.00111 * Math.sin((Math.PI / 180) * (mprime - 2 * f));
          apt1 -= 0.00057 * Math.sin((Math.PI / 180) * (mprime + 2 * f));
          apt1 += 0.00056 * es * Math.sin((Math.PI / 180) * (2 * mprime + m));
          apt1 -= 0.00042 * Math.sin((Math.PI / 180) * 3 * mprime);
          apt1 += 0.00042 * es * Math.sin((Math.PI / 180) * (m + 2 * f));
          apt1 += 0.00038 * es * Math.sin((Math.PI / 180) * (m - 2 * f));
          apt1 -= 0.00024 * es * Math.sin((Math.PI / 180) * (2 * mprime - m));
          apt1 -= 0.00017 * Math.sin((Math.PI / 180) * omega);
          apt1 -= 0.00007 * Math.sin((Math.PI / 180) * (mprime + 2 * m));
          apt1 += 0.00004 * Math.sin((Math.PI / 180) * (2 * mprime - 2 * f));
          apt1 += 0.00004 * Math.sin((Math.PI / 180) * (3 * m));
          apt1 += 0.00003 * Math.sin((Math.PI / 180) * (mprime + m - 2 * f));
          apt1 += 0.00003 * Math.sin((Math.PI / 180) * (2 * mprime + 2 * f));
          apt1 -= 0.00003 * Math.sin((Math.PI / 180) * (mprime + m + 2 * f));
          apt1 += 0.00003 * Math.sin((Math.PI / 180) * (mprime - m + 2 * f));
          apt1 -= 0.00002 * Math.sin((Math.PI / 180) * (mprime - m - 2 * f));
          apt1 -= 0.00002 * Math.sin((Math.PI / 180) * (3 * mprime + m));
          apt1 += 0.00002 * Math.sin((Math.PI / 180) * (4 * mprime));

          apt2 = 0.000325 * Math.sin((Math.PI / 180) * (299.77 + 0.107408 * k - 0.009173 * t2));
          apt2 += 0.000165 * Math.sin((Math.PI / 180) * (251.88 + 0.016321 * k));
          apt2 += 0.000164 * Math.sin((Math.PI / 180) * (251.83 + 26.651886 * k));
          apt2 += 0.000126 * Math.sin((Math.PI / 180) * (349.42 + 36.412478 * k));
          apt2 += 0.00011 * Math.sin((Math.PI / 180) * (84.66 + 18.206239 * k));
          apt2 += 0.000062 * Math.sin((Math.PI / 180) * (141.74 + 53.303771 * k));
          apt2 += 0.00006 * Math.sin((Math.PI / 180) * (207.14 + 2.453732 * k));
          apt2 += 0.000056 * Math.sin((Math.PI / 180) * (154.84 + 7.30686 * k));
          apt2 += 0.000047 * Math.sin((Math.PI / 180) * (34.52 + 27.261239 * k));
          apt2 += 0.000042 * Math.sin((Math.PI / 180) * (207.19 + 0.121824 * k));
          apt2 += 0.00004 * Math.sin((Math.PI / 180) * (291.34 + 1.844379 * k));
          apt2 += 0.000037 * Math.sin((Math.PI / 180) * (161.72 + 24.198154 * k));
          apt2 += 0.000035 * Math.sin((Math.PI / 180) * (239.56 + 25.513099 * k));
          apt2 += 0.000023 * Math.sin((Math.PI / 180) * (331.55 + 3.592518 * k));
          var tnm = pt + apt1 + apt2;
          return tnm;
      }

      //副程式功能：求算以含冬至中氣為陰曆11月開始的連續16個朔望月
      function GetSMsinceWinterSolstice(op, yy, jdws, jdnm) {
          var kn, tjd = new Array, i, k, mjd, thejd;
          var spcjd, phase, kn;
          spcjd = Jdays(op, yy - 1, 11, 0, 0);        //求年初前兩個月附近的新月點(即前一年的11月初)
          kn = MeanNewMoon(spcjd);   //求得自2000年1月起第kn個平均朔望日及其JD值
          for (i = 0; i <= 19; i++) {                         //求出連續20個朔望月
              k = kn + i;
              mjd = thejd + synmonth * i;
              tjd[i] = TrueNewMoon(k) + 1 / 3;      //以k值代入求瞬時朔望日,因中國比格林威治先行8小時，加1/3天
              //下式為修正dynamical time to Universal time
              tjd[i] = tjd[i] - DeltaT(yy, i - 1) / 1440;   //1為1月，0為前一年12月，-1為前一年11月(當i=0時，i-1=-1，代表前一年11月)
          }
          for (j = 0; j <= 18; j++) {
              if (Math.floor(tjd[j] + 0.5) > Math.floor(jdws + 0.5)) { break; }	//已超過冬至中氣(比較日期法)
          }
          jj = j;                                  //取此時的索引值
          for (k = 0; k <= 15; k++) {
              jdnm[k] = tjd[jj - 1 + k];            //重排索引，使含冬至朔望月的索引為0
          }
      }

      //副程式功能：以比較日期法求算冬月及其餘各月名稱代碼，包含閏月，冬月為0，臘月為1，正月為2，餘類推。閏月多加0.5
      function GetZQandSMandLunarMonthCode(op, yy, jdzq, jdnm, mc) {
          var yz;
          GetZQsinceWinterSolstice(yy, jdzq);        //取得以前一年冬至為起點之連續17個中氣
          GetSMsinceWinterSolstice(op, yy, jdzq[0], jdnm);	//求出以含冬至中氣為陰曆11月(冬月)開始的連續16個朔望月的新月點

          yz = 0;      //設定旗標，0表示未遇到閏月，1表示已遇到閏月
          if (Math.floor(jdzq[12] + 0.5) >= Math.floor(jdnm[13] + 0.5)) {      //若第13個中氣jdzq(12)大於或等於第14個新月jdnm(13)
              for (i = 1; i <= 14; i++) {                                 //表示此兩個冬至之間的11個中氣要放到12個朔望月中，
                  //至少有一個朔望月不含中氣，第一個不含中氣的月即為閏月
                  //若陰曆臘月起始日大於冬至中氣日，且陰曆正月起始日小於或等於大寒中氣日，則此月為閏月，其餘同理
                  if (Math.floor((jdnm[i] + 0.5) > Math.floor(jdzq[i - 1 - yz] + 0.5) && Math.floor(jdnm[i + 1] + 0.5) <= Math.floor(jdzq[i - yz] + 0.5))) {
                      mc[i] = i - 0.5;
                      yz = 1;      //標示遇到閏月
                  } else {
                      mc[i] = i - yz;	//遇到閏月開始，每個月號要減1
                  }
              }
          } else {        //否則表示兩個連續冬至之間只有11個整月，故無閏月
              for (i = 0; i <= 12; i++) {     //直接賦予這12個月月代碼
                  mc[i] = i;
              }
              for (i = 13; i <= 14; i++) {        //處理次一置月年的11月與12月，亦有可能含閏月
                  //若次一陰曆臘月起始日大於附近的冬至中氣日，且陰曆正月起始日小於或等於大寒中氣日，則此月為閏月，次一正月同理。
                  if (Math.floor((jdnm[i] + 0.5) > Math.floor(jdzq[i - 1 - yz] + 0.5) && Math.floor(jdnm[i + 1] + 0.5) <= Math.floor(jdzq[i - yz] + 0.5))) {
                      mc[i] = i - 0.5;
                      yz = 1;      //標示遇到閏月
                  } else {
                      mc[i] = i - yz;  //遇到閏月開始，每個月號要減1
                  }
              }
          }
      }


      /////////////////////////////////////////////////////////////////////////////////////
      //var today=new Date();
      //yr=today.getFullYear();
      //mh=today.getMonth()+1;
      //document.getElementById("in1").value=yr;
      //document.getElementById("in2").value=mh;

      var synmonth = 29.530588853;     //synodic month (new Moon to new Moon)
      var ptsa = new Array(485, 203, 199, 182, 156, 136, 77, 74, 70, 58, 52, 50, 45, 44, 29, 18, 17, 16, 14, 12, 12, 12, 9, 8);
      var ptsb = new Array(324.96, 337.23, 342.08, 27.85, 73.14, 171.52, 222.54, 296.72, 243.58, 119.81, 297.17, 21.02, 247.54, 325.15, 60.93, 155.12, 288.79, 198.04, 199.76, 95.39, 287.11, 320.81, 227.73, 15.45);
      var ptsc = new Array(1934.136, 32964.467, 20.186, 445267.112, 45036.886, 22518.443, 65928.934, 3034.906, 9037.513, 33718.147, 150.678, 2281.226, 29929.562, 31555.956, 4443.417, 67555.328, 4562.452, 62894.029, 31436.921, 14577.848, 31931.756, 34777.259, 1222.114, 16859.074);
      var ctg = new Array("甲", "乙", "丙", "丁", "戊", "己", "庚", "辛", "壬", "癸");
      var cdz = new Array("子", "丑", "寅", "卯", "辰", "巳", "午", "未", "申", "酉", "戌", "亥");
      var wkd = new Array("日", "一", "二", "三", "四", "五", "六");

      var jdez = new Array;
      var outs = new Array;

      function SoLuGzJd(in1, in2, k) {	//此程式功能為顯示整月陽曆陰曆干支曆儒略日對照。此程式適用範圍為-1000至3000年
          //陽曆的各變數
          var yea, zr = new Array, jdt, jdx, djd = new Array, jr = new Array, ty;
          var tg = new Array, dz = new Array, dayjd, op, dom, kk;
          //陰曆的各變數
          var pod;
          var sjd = new Array, mc = new Array, lsjd, mis;
          //取得輸入之陽曆年月值

          //var yea=in1.value-0;	//取得年之輸入值
          //var mx=in2.value-0;	//取得月之輸入值
          var yea = in1 - 0;	//取得年之輸入值
          var mx = in2 - 0;	//取得月之輸入值
          var dx = 1;	//從每月的1日開始列印
          var flag = 0;
          var out = "";
          //限定範圍
          if (yea < -7000 || yea > 7000) {
              alert("超出計算能力");
              return false;
          }
          if (yea < -1000 || yea > 3000) {
              alert("适用于西元-1000年至西元3000年，超出此范&#22260;&#35823;差&#36739;大");
          }

          //驗證輸入日期的正確性,若不正確則跳離
          if (ValidDate(op, yea, mx, dx) == false) { return false; }
          GetZQandSMandLunarMonthCode(op, yea, zr, sjd, mc);
          var jdt = Jdays(op, yea, mx, dx, 12);    //求出指定年月日之JD值
          if (Math.floor(jdt) < Math.floor(sjd[0] + 0.5)) { flag = 1; GetZQandSMandLunarMonthCode(op, yea - 1, zr, sjd, mc); }

          //將1582年10月的天數獨立處理
          if ((yea == 1582 && mx == 10) && (!op)) {
              dom = 20;
          } else {    //其餘的月份天數由下列公式算出
              atf = ((yea % 400 == 0) || (!((yea > 1582) || op) || !(yea % 100 == 0)) && (yea % 4 == 0)) && (mx == 2);
              dom = 30 + ((Math.abs(mx - 7.5) + 0.5) % 2) - 2 * (mx == 2) + atf;        //將每月最大日期對應到28,29,30或31
          }

          out += "       陽曆     星期        陰曆               干支曆          儒略日\r\n";
          for (kk = 0; kk <= dom - 1; kk++) {
              jdx = jdt + kk;
              for (i = 0; i <= 14; i++) {
                  //下面的指令中加0.5是為了改為從0時算起而不從正午算起
                  if ((Math.floor(jdx) >= Math.floor(sjd[i] + 0.5)) && (Math.floor(jdx) < Math.floor(sjd[i + 1] + 0.5))) { mi = i; break; }
              }
              di = Math.floor(jdx) - Math.floor(sjd[mi] + 0.5) + 1;       //此處加1是因為每月初一從1開始而非從0開始
              if (mc[mi] < 2 || flag == 1) { yi = yea - 1; } else { yi = yea; }	//以月來調整年,因mc(mi)=0對應到前一年陰曆11月，mc(mi)=1對應到前一年陰曆12月，mc(mi)=2對應到本年1月，依此類推


              if ((mc[mi] - Math.floor(mc[mi])) * 2 + 1 == 1) { ry = ""; } else { ry = "閏"; }
              mis = (Math.floor(mc[mi] + 10) % 12) + 1;        //對應到月份
              if ((yea == 1582 && mx == 10) && (!op) && (kk > 3)) { pod = kk + 11; } else { pod = kk + 1; }	//對應到日

              var yc1 = "     " + yea;
              yc1 = yc1.substr(yc1.length - 5, 5);
              var nyds1 = yc1; nyds1 += "年";
              nyds1 += ((mx < 10) ? " " : "") + mx + "月";
              nyds1 += ((pod < 10) ? " " : "") + pod + "日 ";
              out += nyds1;
              var wk = (((Math.floor(jdx + 1) % 7)) + 7) % 7;	//模數(或餘數)為0代表星期日。jda加1是因起始日為星期一
              out += wkd[wk] + "  ";
              var yc2 = "" + yi;
              //yc2 = yc2.substr(yc2.length - 5, 5);
              var nyds2 = "農曆" + yc2 + "年";    /// nyds2 += "農年";
              nyds2 += ry + ((mis < 10) ? "0" : "") + mis + "月";
              nyds2 += ((di < 10) ? "0" : "") + di + "日";
              out += nyds2;

              GetGZ(op, jdx - 0.5, yea, ptsa, ptsb, ptsc, tg, dz);
              out += ctg[tg[0]] + cdz[dz[0]] + ctg[tg[1]] + cdz[dz[1]] + ctg[tg[2]] + cdz[dz[2]] + ctg[tg[3]] + cdz[dz[3]] ;
              out += jdx - 0.5
              out += "\r\n";
              outs[kk + 1] = nyds2 + ctg[tg[0]] + cdz[dz[0]] + ctg[tg[1]] + cdz[dz[1]] + ctg[tg[2]] + cdz[dz[2]];
             //outs[kk + 1] =  ctg[tg[0]] + cdz[dz[0]] + ctg[tg[1]] + cdz[dz[1]] + ctg[tg[2]] + cdz[dz[2]] ;
              //outs[kk]=out;
              //return out;
              //show1.innerText=out;	//for IE
              //show1.textContent=out;	//for mozilla
           }
          //return out;
          return outs[k];
      }

      function ValidDate(op, yy, mm, dd) {//驗證日期是否有效
          var vd = true;
          if (mm <= 0 || mm > 12) {
              alert("月份超出範圍");
              vd = false;
          }
          else {
              var ndf1 = -(yy % 4 == 0);	//可被四整除
              var ndf2 = ((yy % 400 == 0) - (yy % 100 == 0)) && (((yy > 1582) && (!op)) || op);
              var ndf = ndf1 + ndf2;
              var dom = 30 + ((Math.abs(mm - 7.5) + 0.5) % 2) - (mm == 2) * (2 + ndf);
              if (dd <= 0 || dd > dom) {
                  if (ndf == 0 && mm == 2 && dd == 29) {
                      alert("此年無閏月");
                  }
                  else {
                      alert("日期超出範圍");
                  }
                  vd = false;
              }
          }
          if ((yy == 1582 && mm == 10 && dd >= 5 && dd < 15) && !op) {
              alert("此日期不存在");
              vd = false;
          }
          return vd;
      }

      function VE(yy) {//&#35745;算指定年的春分&#28857;
          var yx = yy;
          if (yx >= 1000 && yx <= 8001) {
              var m = (yx - 2000) / 1000;
              jdve = 2451623.80984 + 365242.37404 * m + 0.05169 * m * m - 0.00411 * m * m * m - 0.00057 * m * m * m * m;
          }
          else {
              if (yx >= -8000 && yx < 1000) {
                  m = yx / 1000;
                  jdve = 1721139.29189 + 365242.1374 * m + 0.06134 * m * m + 0.00111 * m * m * m - 0.00071 * m * m * m * m;
              }
              else {
                  alter("超出&#35745;算能力范&#22260;");
                  return false;
              }
          }
          return jdve
      }

      function MeanJQJD(yy, jdve, ty, ini, num) {
          var ath = 2 * Math.PI / 24;
          var tx = (jdve - 2451545) / 365250;
          var e = 0.0167086342 - 0.0004203654 * tx - 0.0000126734 * tx * tx + 0.0000001444 * tx * tx * tx - 0.0000000002 * tx * tx * tx * tx + 0.0000000003 * tx * tx * tx * tx * tx;
          var tt = yy / 1000;
          var vp = 111.25586939 - 17.0119934518333 * tt - 0.044091890166673 * tt * tt - 4.37356166661345E-04 * tt * tt * tt + 8.16716666602386E-06 * tt * tt * tt * tt;
          var rvp = vp * 2 * Math.PI / 360;
          var peri = new Array(30);
          var i;
          for (i = 1; i <= (ini + num) ; i++) {
              var flag = 0;
              var th = ath * (i - 1) + rvp;
              if (th > Math.PI && th <= 3 * Math.PI) {
                  th = 2 * Math.PI - th;
                  flag = 1;
              }
              if (th > 3 * Math.PI) {
                  th = 4 * Math.PI - th;
                  flag = 2;
              }
              var f1 = 2 * Math.atan((Math.sqrt((1 - e) / (1 + e)) * Math.tan(th / 2)));
              var f2 = (e * Math.sqrt(1 - e * e) * Math.sin(th)) / (1 + e * Math.cos(th));
              var f = (f1 - f2) * ty / 2 / Math.PI;
              if (flag == 1) f = ty - f;
              if (flag == 2) f = 2 * ty - f;
              peri[i] = f;
          }
          for (i = ini; i <= (ini + num) ; i++) {
              jdez[i] = jdve + peri[i] - peri[1];
          }
          return true;
      }

      function Perturbation(jdez) {
          var t = (jdez - 2451545) / 36525;
          var s = 0;
          for (k = 0; k <= 23; k++) {
              s = s + ptsa[k] * Math.cos(ptsb[k] * 2 * Math.PI / 360 + ptsc[k] * 2 * Math.PI / 360 * t);
          }
          var w = 35999.373 * t - 2.47;
          var l = 1 + 0.0334 * Math.cos(w * 2 * Math.PI / 360) + 0.0007 * Math.cos(2 * w * 2 * Math.PI / 360);
          var ptb = 0.00001 * s / l;
          return ptb;
      }

      function DeltaT(yy, mm) {
          var u, t, dt, y;
          y = yy + (mm - 0.5) / 12;

          if (y <= -500) {
              u = (y - 1820) / 100;
              dt = (-20 + 32 * u * u);
          }
          else {
              if (y < 500) {
                  u = y / 100;
                  dt = (10583.6 - 1014.41 * u + 33.78311 * u * u - 5.952053 * u * u * u - 0.1798452 * u * u * u * u + 0.022174192 * u * u * u * u * u + 0.0090316521 * u * u * u * u * u * u);
              }
              else {
                  if (y < 1600) {
                      u = (y - 1000) / 100;
                      dt = (1574.2 - 556.01 * u + 71.23472 * u * u + 0.319781 * u * u * u - 0.8503463 * u * u * u * u - 0.005050998 * u * u * u * u * u + 0.0083572073 * u * u * u * u * u * u);
                  }
                  else {
                      if (y < 1700) {
                          t = y - 1600;
                          dt = (120 - 0.9808 * t - 0.01532 * t * t + t * t * t / 7129);
                      }
                      else {
                          if (y < 1800) {
                              t = y - 1700;
                              dt = (8.83 + 0.1603 * t - 0.0059285 * t * t + 0.00013336 * t * t * t - t * t * t * t / 1174000);
                          }
                          else {
                              if (y < 1860) {
                                  t = y - 1800;
                                  dt = (13.72 - 0.332447 * t + 0.0068612 * t * t + 0.0041116 * t * t * t - 0.00037436 * t * t * t * t + 0.0000121272 * t * t * t * t * t - 0.0000001699 * t * t * t * t * t * t + 0.000000000875 * t * t * t * t * t * t * t);
                              }
                              else {
                                  if (y < 1900) {
                                      t = y - 1860;
                                      dt = (7.62 + 0.5737 * t - 0.251754 * t * t + 0.01680668 * t * t * t - 0.0004473624 * t * t * t * t + t * t * t * t * t / 233174);
                                  }
                                  else {
                                      if (y < 1920) {
                                          t = y - 1900;
                                          dt = (-2.79 + 1.494119 * t - 0.0598939 * t * t + 0.0061966 * t * t * t - 0.000197 * t * t * t * t);
                                      }
                                      else {
                                          if (y < 1941) {
                                              t = y - 1920;
                                              dt = (21.2 + 0.84493 * t - 0.0761 * t * t + 0.0020936 * t * t * t);
                                          }
                                          else {
                                              if (y < 1961) {
                                                  t = y - 1950;
                                                  dt = (29.07 + 0.407 * t - t * t / 233 + t * t * t / 2547);
                                              }
                                              else {
                                                  if (y < 1986) {
                                                      t = y - 1975;
                                                      dt = (45.45 + 1.067 * t - t * t / 260 - t * t * t / 718);
                                                  }
                                                  else {
                                                      if (y < 2005) {
                                                          t = y - 2000;
                                                          dt = (63.86 + 0.3345 * t - 0.060374 * t * t + 0.0017275 * t * t * t + 0.000651814 * t * t * t * t + 0.00002373599 * t * t * t * t * t);
                                                      }
                                                      else {
                                                          if (y < 2050) {
                                                              t = y - 2000;
                                                              dt = (62.92 + 0.32217 * t + 0.005589 * t * t);
                                                          }
                                                          else {
                                                              if (y < 2150) {
                                                                  u = (y - 1820) / 100;
                                                                  dt = (-20 + 32 * u * u - 0.5628 * (2150 - y));
                                                              }
                                                              else {
                                                                  u = (y - 1820) / 100;
                                                                  dt = (-20 + 32 * u * u);
                                                              }
                                                          }
                                                      }
                                                  }
                                              }
                                          }
                                      }
                                  }
                              }
                          }
                      }
                  }
              }
          }

          if (y < 1955 || y >= 2005) dt = dt - (0.000012932 * (y - 1955) * (y - 1955));
          var DeltaT = dt / 60;    //將秒轉換為分
          return DeltaT
      }

      function Jdays(op, yr, mh, dy, hr) {//將年月日時，轉&#25442;&#29234;儒略日
          if (yr < -400000 || yr > 400000) return false;
          var yp = yr + Math.floor((mh - 3) / 10);
          if (((yr > 1582) || (yr == 1582 && mh > 10) || (yr == 1582 && mh == 10 && dy >= 15)) || op) {
              var init = 1721119.5;
              var jdy = Math.floor(yp * 365.25) - Math.floor(yp / 100) + Math.floor(yp / 400);
          }
          else {
              if ((yr < 1582) || (yr == 1582 && mh < 10) || (yr == 1582 && mh == 10 && dy <= 4)) {
                  var init = 1721117.5;
                  var jdy = Math.floor(yp * 365.25);
              }
              else { return false; }
          }
          var mp = Math.floor(mh + 9) % 12;
          var jdm = mp * 30 + Math.floor((mp + 1) * 34 / 57);
          var jdd = dy - 1;
          var jdh = hr / 24;
          var jd = jdy + jdm + jdd + jdh + init;
          return jd;
      }

      //副程式功能：對Perturbaton作調整後的自春分點開始的24節氣,可只取部份
      function GetAdjustedJQ(yy, ini, num, jdjq) {
          var veb = VE(yy);
          var ty = VE(yy + 1) - veb;     //求指定年的春分點及回歸年長
          if (MeanJQJD(yy, veb, ty, ini, num) == true) {	//輸入指定年,JD,回歸年長,求該回歸年各節氣之長
              for (i = ini + 1; i <= (ini + num) ; i++) {
                  ptb = Perturbation(jdez[i]);	//取得受perturbation影響所需微調
                  dt = DeltaT(yy, Math.floor(i / 2) + 3);	//修正dynamical time to Universal time
                  jdjq[i] = jdez[i] + ptb - dt / 60 / 24;	//加上攝動調整值ptb，減去對應的Delta T值(分鐘轉換為日)
                  jdjq[i] = jdjq[i] + 1 / 3;	//因中國時間比格林威治時間先行8小時，即1/3日
              }
          }

      }

      //副程式功能：求出自冬至點為起點的連續16個中氣
      function GetZQsinceWinterSolstice(yy, jdzq) {
          //求出以冬至為起點之連續16個中氣（多取四個以備用）
          var dj = new Array(26);
          GetAdjustedJQ(yy - 1, 18, 5, dj);	//求出指定年冬至開始之節氣JD值,以前一年的值代入
          //轉移春分前之節氣至jdzq變數中，以重整index
          jdzq[0] = dj[19];                    //此為冬至中氣
          jdzq[1] = dj[21];                    //此為大寒中氣
          jdzq[2] = dj[23];                    //此為雨水中氣
          GetAdjustedJQ(yy, 0, 26, dj); //求出指定年節氣之JD值
          for (i = 1; i <= 13; i++) {
              jdzq[i + 2] = dj[2 * i - 1];     //轉移冬至後之節氣至jdzq變數中，以重整index
          }
      }

      //副程式功能：對於指定日期時刻所屬的朔望月，求出其均值新月點的月序數
      function MeanNewMoon(jd) {
          var t, thejd, jdt;
          //k為從2000年1月6日14時20分36秒起至指定年月日之陰曆月數,以synodic month為單位
          var k = Math.floor((jd - 2451550.09765) / synmonth); //2451550.09765為2000年1月6日14時20分36秒之JD值。
          jdt = 2451550.09765 + k * synmonth;
          //Time in Julian centuries from 2000 January 0.5.
          t = (jdt - 2451545) / 36525;  //以100年為單位,以2000年1月1日12時為0點
          thejd = jdt + 0.0001337 * t * t - 0.00000015 * t * t * t + 0.00000000073 * t * t * t * t;
          //2451550.09765為2000年1月6日14時20分36秒，此為2000年後的第一個均值新月
          return k;
      }

      //函式功能:求出實際新月點
      //以2000年初的第一個均值新月點為0點求出的均值新月點和其朔望月之序數k
      //代入此副程式來求算實際新月點
      function TrueNewMoon(k) {
          var t, t2, t3, t4;
          var m, mprime, f, omega, es;
          var pt, apt1, apt2, jdt;
          jdt = 2451550.09765 + k * synmonth;
          t = (jdt - 2451545) / 36525;	//2451545為2000年1月1日正午12時的JD
          t2 = t * t;      //square for frequent use
          t3 = t2 * t;     //cube for frequent use
          t4 = t3 * t;     //to the fourth
          //mean time of phase
          pt = jdt + 0.0001337 * t2 - 0.00000015 * t3 + 0.00000000073 * t4;
          //Sun's mean anomaly(地球繞太陽運行均值近點角)(從太陽觀察)
          m = 2.5534 + 29.10535669 * k - 0.0000218 * t2 - 0.00000011 * t3;
          //Moon's mean anomaly(月球繞地球運行均值近點角)(從地球觀察)
          mprime = 201.5643 + 385.81693528 * k + 0.0107438 * t2 + 0.00001239 * t3 - 0.000000058 * t4;
          //Moon's argument of latitude(月球的緯度參數)
          f = 160.7108 + 390.67050274 * k - 0.0016341 * t2 - 0.00000227 * t3 + 0.000000011 * t4;
          //Longitude of the ascending node of the lunar orbit(月球繞日運行軌道升交點之經度)
          omega = 124.7746 - 1.5637558 * k + 0.0020691 * t2 + 0.00000215 * t3;
          //乘式因子
          es = 1 - 0.002516 * t - 0.0000074 * t2;
          //因perturbation造成的偏移：
          apt1 = -0.4072 * Math.sin((Math.PI / 180) * mprime);
          apt1 += 0.17241 * es * Math.sin((Math.PI / 180) * m);
          apt1 += 0.01608 * Math.sin((Math.PI / 180) * 2 * mprime);
          apt1 += 0.01039 * Math.sin((Math.PI / 180) * 2 * f);
          apt1 += 0.00739 * es * Math.sin((Math.PI / 180) * (mprime - m));
          apt1 -= 0.00514 * es * Math.sin((Math.PI / 180) * (mprime + m));
          apt1 += 0.00208 * es * es * Math.sin((Math.PI / 180) * (2 * m));
          apt1 -= 0.00111 * Math.sin((Math.PI / 180) * (mprime - 2 * f));
          apt1 -= 0.00057 * Math.sin((Math.PI / 180) * (mprime + 2 * f));
          apt1 += 0.00056 * es * Math.sin((Math.PI / 180) * (2 * mprime + m));
          apt1 -= 0.00042 * Math.sin((Math.PI / 180) * 3 * mprime);
          apt1 += 0.00042 * es * Math.sin((Math.PI / 180) * (m + 2 * f));
          apt1 += 0.00038 * es * Math.sin((Math.PI / 180) * (m - 2 * f));
          apt1 -= 0.00024 * es * Math.sin((Math.PI / 180) * (2 * mprime - m));
          apt1 -= 0.00017 * Math.sin((Math.PI / 180) * omega);
          apt1 -= 0.00007 * Math.sin((Math.PI / 180) * (mprime + 2 * m));
          apt1 += 0.00004 * Math.sin((Math.PI / 180) * (2 * mprime - 2 * f));
          apt1 += 0.00004 * Math.sin((Math.PI / 180) * (3 * m));
          apt1 += 0.00003 * Math.sin((Math.PI / 180) * (mprime + m - 2 * f));
          apt1 += 0.00003 * Math.sin((Math.PI / 180) * (2 * mprime + 2 * f));
          apt1 -= 0.00003 * Math.sin((Math.PI / 180) * (mprime + m + 2 * f));
          apt1 += 0.00003 * Math.sin((Math.PI / 180) * (mprime - m + 2 * f));
          apt1 -= 0.00002 * Math.sin((Math.PI / 180) * (mprime - m - 2 * f));
          apt1 -= 0.00002 * Math.sin((Math.PI / 180) * (3 * mprime + m));
          apt1 += 0.00002 * Math.sin((Math.PI / 180) * (4 * mprime));

          apt2 = 0.000325 * Math.sin((Math.PI / 180) * (299.77 + 0.107408 * k - 0.009173 * t2));
          apt2 += 0.000165 * Math.sin((Math.PI / 180) * (251.88 + 0.016321 * k));
          apt2 += 0.000164 * Math.sin((Math.PI / 180) * (251.83 + 26.651886 * k));
          apt2 += 0.000126 * Math.sin((Math.PI / 180) * (349.42 + 36.412478 * k));
          apt2 += 0.00011 * Math.sin((Math.PI / 180) * (84.66 + 18.206239 * k));
          apt2 += 0.000062 * Math.sin((Math.PI / 180) * (141.74 + 53.303771 * k));
          apt2 += 0.00006 * Math.sin((Math.PI / 180) * (207.14 + 2.453732 * k));
          apt2 += 0.000056 * Math.sin((Math.PI / 180) * (154.84 + 7.30686 * k));
          apt2 += 0.000047 * Math.sin((Math.PI / 180) * (34.52 + 27.261239 * k));
          apt2 += 0.000042 * Math.sin((Math.PI / 180) * (207.19 + 0.121824 * k));
          apt2 += 0.00004 * Math.sin((Math.PI / 180) * (291.34 + 1.844379 * k));
          apt2 += 0.000037 * Math.sin((Math.PI / 180) * (161.72 + 24.198154 * k));
          apt2 += 0.000035 * Math.sin((Math.PI / 180) * (239.56 + 25.513099 * k));
          apt2 += 0.000023 * Math.sin((Math.PI / 180) * (331.55 + 3.592518 * k));
          var tnm = pt + apt1 + apt2;
          return tnm;
      }

      //副程式功能：求算以含冬至中氣為陰曆11月開始的連續16個朔望月
      function GetSMsinceWinterSolstice(op, yy, jdws, jdnm) {
          var kn, tjd = new Array, i, k, mjd, thejd;
          var spcjd, phase, kn;
          spcjd = Jdays(op, yy - 1, 11, 0, 0);        //求年初前兩個月附近的新月點(即前一年的11月初)
          kn = MeanNewMoon(spcjd);   //求得自2000年1月起第kn個平均朔望日及其JD值
          for (i = 0; i <= 19; i++) {                         //求出連續20個朔望月
              k = kn + i;
              mjd = thejd + synmonth * i;
              tjd[i] = TrueNewMoon(k) + 1 / 3;      //以k值代入求瞬時朔望日,因中國比格林威治先行8小時，加1/3天
              //下式為修正dynamical time to Universal time
              tjd[i] = tjd[i] - DeltaT(yy, i - 1) / 1440;   //1為1月，0為前一年12月，-1為前一年11月(當i=0時，i-1=-1，代表前一年11月)
          }
          for (j = 0; j <= 18; j++) {
              if (Math.floor(tjd[j] + 0.5) > Math.floor(jdws + 0.5)) { break; }	//已超過冬至中氣(比較日期法)
          }
          jj = j;                                  //取此時的索引值
          for (k = 0; k <= 15; k++) {
              jdnm[k] = tjd[jj - 1 + k];            //重排索引，使含冬至朔望月的索引為0
          }
      }

      //副程式功能：以比較日期法求算冬月及其餘各月名稱代碼，包含閏月，冬月為0，臘月為1，正月為2，餘類推。閏月多加0.5
      function GetZQandSMandLunarMonthCode(op, yy, jdzq, jdnm, mc) {
          var yz;
          GetZQsinceWinterSolstice(yy, jdzq);        //取得以前一年冬至為起點之連續17個中氣
          GetSMsinceWinterSolstice(op, yy, jdzq[0], jdnm);	//求出以含冬至中氣為陰曆11月(冬月)開始的連續16個朔望月的新月點

          yz = 0;      //設定旗標，0表示未遇到閏月，1表示已遇到閏月
          if (Math.floor(jdzq[12] + 0.5) >= Math.floor(jdnm[13] + 0.5)) {      //若第13個中氣jdzq(12)大於或等於第14個新月jdnm(13)
              for (i = 1; i <= 14; i++) {                                 //表示此兩個冬至之間的11個中氣要放到12個朔望月中，
                  //至少有一個朔望月不含中氣，第一個不含中氣的月即為閏月
                  //若陰曆臘月起始日大於冬至中氣日，且陰曆正月起始日小於或等於大寒中氣日，則此月為閏月，其餘同理
                  if (Math.floor((jdnm[i] + 0.5) > Math.floor(jdzq[i - 1 - yz] + 0.5) && Math.floor(jdnm[i + 1] + 0.5) <= Math.floor(jdzq[i - yz] + 0.5))) {
                      mc[i] = i - 0.5;
                      yz = 1;      //標示遇到閏月
                  } else {
                      mc[i] = i - yz;	//遇到閏月開始，每個月號要減1
                  }
              }
          } else {        //否則表示兩個連續冬至之間只有11個整月，故無閏月
              for (i = 0; i <= 12; i++) {     //直接賦予這12個月月代碼
                  mc[i] = i;
              }
              for (i = 13; i <= 14; i++) {        //處理次一置月年的11月與12月，亦有可能含閏月
                  //若次一陰曆臘月起始日大於附近的冬至中氣日，且陰曆正月起始日小於或等於大寒中氣日，則此月為閏月，次一正月同理。
                  if (Math.floor((jdnm[i] + 0.5) > Math.floor(jdzq[i - 1 - yz] + 0.5) && Math.floor(jdnm[i + 1] + 0.5) <= Math.floor(jdzq[i - yz] + 0.5))) {
                      mc[i] = i - 0.5;
                      yz = 1;      //標示遇到閏月
                  } else {
                      mc[i] = i - yz;  //遇到閏月開始，每個月號要減1
                  }
              }
          }
      }

      //副程式功能：求出以立春點開始的不含中氣之12節氣
      function GetPureJQsinceSpring(yy, ptsa, ptsb, ptsc, jdpjq) {
          var sjdjq = new Array;
          var yea = yy - 1;
          GetAdjustedJQ(yea, 21, 3, sjdjq);   //求出含指定年立春開始之3個節氣JD值,以前一年的年值代入
          //轉移春分前之立春至驚蟄之節氣至jdpjq變數中，以重整index
          jdpjq[0] = sjdjq[22];                     //此為立春
          jdpjq[1] = sjdjq[24];                     //此為驚蟄
          yea = yy;
          GetAdjustedJQ(yea, 0, 26, sjdjq);       //求出指定年節氣之JD值,從驚蟄開始，到雨水
          //轉移春分至小寒之節氣至jdpjq變數中，以重整index
          for (i = 1; i <= 13; i++) {
              jdpjq[i + 1] = sjdjq[2 * i];
          }
      }

      function GetGZ(op, spcjd, yea, ptsa, ptsb, ptsc, tg, dz) {
          //比較求算節氣年ty,求出年干支
          var jr = new Array;
          ty = yea;
          GetPureJQsinceSpring(yea, ptsa, ptsb, ptsc, jr);	//取得自立春開始的非中氣之24節氣
          //if(spcjd <jr[0]){	//jr[0]為立春，約在2月5日前後，
          if (spcjd < jr[0] - 1) {
              ty = yea - 1;            //若小於jr[0],則屬於前一個節氣年
              GetPureJQsinceSpring(ty, ptsa, ptsb, ptsc, jr);     //取得自立春開始的不含中氣之12節氣
          }

          ygz = ((ty + 4712 + 24) % 60 + 60) % 60;
          tg[0] = ygz % 10;         //年干
          dz[0] = ygz % 12;         //年支

          //比較求算節氣月,求出月干支
          for (j = 0; j <= 13; j++) {
              //if(jr[j] >= spcjd){ tm = j - 1; break;}		//已超過指定時刻，故應取前一個節氣
              if (spcjd <= jr[j] - 1) { tm = j - 1; break; }		//已超過指定時刻，故應取前一個節氣
          }
          tmm = ((ty + 4712) * 12 + (tm) + 60) % 60;
          mgz = (tmm + 50) % 60;
          tg[1] = mgz % 10;        //月干
          dz[1] = mgz % 12;         //月支

          //計算日柱之干支
          //jda = Jdays(op, yea, tmon, tday, thehou) + 0.5;     //加0.5是將起始點從正午改為從0點開始。
          jda = spcjd + 0.5;
          thes = ((jda - Math.floor(jda)) * 86400) + 3600;    //將jd的小數部份化為秒，並加上起始點前移的一小時(3600秒)，取其整數值
          dayjd = Math.floor(jda) + thes / 86400;              //將秒數化為日數，加回到jd的整數部份
          dgz = (Math.floor(dayjd + 49) % 60 + 60) % 60;
          tg[2] = dgz % 10;    //日干
          dz[2] = dgz % 12;    //日支

          //計算時柱之干支
          dh = dayjd * 12;
          hgz = (Math.floor(dh + 48) % 60 + 60) % 60;
          tg[3] = hgz % 10;    //時干
          dz[3] = hgz % 12;    //時支

      }

 </script>
 